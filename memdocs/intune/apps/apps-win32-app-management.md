---
title: Win32 アプリを追加し、Microsoft Intune に割り当てる
titleSuffix: ''
description: Microsoft Intune を使用して Win32 アプリを追加し、割り当て、管理する方法を学習します。 このトピックでは、Win32 アプリを配信および管理する Intune の機能の概要と、Win32 アプリのトラブルシューティング情報について説明します。
keywords: ''
author: Erikre
ms.author: erikre
manager: dougeby
ms.date: 04/02/2020
ms.topic: conceptual
ms.service: microsoft-intune
ms.subservice: apps
ms.localizationpriority: high
ms.technology: ''
ms.assetid: efdc196b-38f3-4678-ae16-cdec4303f8d2
ms.reviewer: mghadial
ms.suite: ems
search.appverid: MET150
ms.custom: intune-azure
ms.collection: M365-identity-device-management
ms.openlocfilehash: 8d1933350675a0d36042d1a4bd1e6a26c9a95814
ms.sourcegitcommit: 0e62655fef7afa7b034ac11d5f31a2a48bf758cb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/29/2020
ms.locfileid: "82254607"
---
# <a name="intune-standalone---win32-app-management"></a>Intune スタンドアロン - Win32 アプリ管理

[Intune スタンドアロン](../fundamentals/mdm-authority-set.md)では、Win32 アプリのより優れた管理機能を利用できるようになりました。 クラウドに接続された顧客が Win32 アプリの管理用に Configuration Manager を使用することはできますが、Intune 限定の顧客の方が、Win32 基幹業務 (LOB) アプリに対してより優れた管理機能を利用できます。 このトピックでは、Win32 アプリを管理する Intune の機能の概要と、トラブルシューティング情報について説明します。

> [!NOTE]
> このアプリの管理機能では、Windows アプリケーションの 32 ビットと 64 ビットの両方のオペレーティング システム アーキテクチャがサポートされます。

> [!IMPORTANT]
> Win32 アプリを展開する場合、特にマルチファイルの Win32 アプリ インストーラーがある場合は、[Intune 管理拡張機能](../apps/intune-management-extension.md)の方法を排他的に使用することを検討してください。 AutoPilot 登録中に Win32 アプリと基幹業務アプリのインストールを混在させると、アプリのインストールが失敗する場合があります。 PowerShell スクリプトまたは Win32 アプリがユーザーまたはデバイスに割り当てられると、Intune 管理拡張機能が自動的にインストールされます。

## <a name="prerequisites"></a>[前提条件]

Win32 アプリの管理を使用する場合は、必ず、次の基準を満たすようにしてください。

- Windows 10 バージョン 1607 以降 (Enterprise、Pro、Education バージョン)
- Windows 10 クライアントは次の状態である必要があります 
  - デバイスを Azure AD に参加させ、自動登録する必要があります。 Intune 管理拡張機能では、Azure AD 参加済み、ハイブリッド ドメイン参加済み、グループ ポリシー登録済みのデバイスがサポートされます。 
  > [!NOTE]
  > グループ ポリシー登録済みのシナリオの場合 - エンド ユーザーはローカル ユーザー アカウントを使用して、Windows 10 デバイスを AAD に参加させます。 ユーザーは、AAD ユーザー アカウントを使用してデバイスにログオンし、Intune に登録する必要があります。 PowerShell スクリプトまたは Win32 アプリのターゲットがユーザーまたはデバイスである場合、Intune でデバイス上に Intune 管理拡張機能がインストールされます。
- Windows アプリケーションのサイズはアプリごとに 8 GB に制限されています。

## <a name="prepare-the-win32-app-content-for-upload"></a>Win32 アプリ コンテンツのアップロードを準備する

[Microsoft Win32 コンテンツ準備ツール](https://go.microsoft.com/fwlink/?linkid=2065730)を使用して、Windows クラシック (Win32) アプリを事前処理します。 このツールは、アプリケーション インストール ファイルを *.intunewin* 形式に変換します。 また、このツールは、Intune でアプリケーションのインストール状態を判断するのに必要な属性の一部を検出します。 アプリのインストーラー フォルダーでこのツールを使用した後、Intune コンソールで Win32 アプリを作成できます。

> [!IMPORTANT]
> [Microsoft Win32 コンテンツ準備ツール](https://go.microsoft.com/fwlink/?linkid=2065730)では、 *.intunewin* ファイルの作成時に、すべてのファイルとサブフォルダーを zip 圧縮します。 必ず、Microsoft Win32 コンテンツ準備ツールを、インストーラー ファイルとフォルダーから切り離し、 *.intunewin* ファイルにツールや他の不要なファイルとフォルダーを含めないようにしてください。

[Microsoft Win32 コンテンツ準備ツール](https://go.microsoft.com/fwlink/?linkid=2065730)は、GitHub から zip ファイルとしてダウンロードできます。 zip ファイルには、**Microsoft-Win32-Content-Prep-Tool-master** という名前のフォルダーが含まれています。 フォルダーには準備ツール、ライセンス、readme、およびリリース ノートが含まれています。 

### <a name="process-flow-to-create-intunewin-file"></a>.intunewin ファイルを作成するプロセス フロー

   <img alt="Process flow to create a .intunewin file" src="./media/apps-win32-app-management/prepare-win32-app.png" width="700">

### <a name="run-the-microsoft-win32-content-prep-tool"></a>Microsoft Win32 コンテンツ準備ツールを実行する

コマンド ウィンドウからパラメーターを指定せずに `IntuneWinAppUtil.exe` を実行する場合、ツールによって、段階的に必要なパラメーターを入力する方法が示されます。 以下の使用可能なコマンド ライン パラメーターに基づいて、コマンドにパラメーターを追加することもできます。

### <a name="available-command-line-parameters"></a>使用可能なコマンド ライン パラメーター 

|    **コマンド ライン パラメーター**    |    **説明**    |
|:------------------------------:|:----------------------------------------------------------:|
|    `-h`     |    ヘルプ    |
|    `-c <setup_folder>`     |    すべてのセットアップ ファイルのフォルダー。 このフォルダー内のすべてのファイルは、 *.intunewin* ファイルに圧縮されます。    |
|    `-s <setup_file>`     |    セットアップ ファイル (*setup.exe*、*setup.msi* など)。    |
|    `-o <output_folder>`     |    生成された *.intunewin* ファイルの出力フォルダー。    |
|    `-q`       |    Quiet モード。    |

### <a name="example-commands"></a>コマンドの例

|    **コマンド例**    |    **説明**    |
|:-----------------------------------------------------------------------------------------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|    `IntuneWinAppUtil -h`    |    このコマンドでは、ツールの使用情報が表示されます。    |
|    `IntuneWinAppUtil -c c:\testapp\v1.0 -s c:\testapp\v1.0\setup.exe -o c:\testappoutput\v1.0 -q`    |    このコマンドは、指定されたソース フォルダーおよびセットアップ ファイルから `.intunewin` ファイルを生成します。 MSI セットアップ ファイルでは、このツールは Intune に必要な情報を取得します。 `-q` が指定されている場合、コマンドは Quiet モードで実行され、出力ファイルが既に存在する場合は上書きされます。 また、出力フォルダーが存在しない場合は、自動的に作成されます。    |

*.intunewin* ファイルを生成する場合、参照するために必要なすべてのファイルをセットアップ フォルダーのサブフォルダーに置いてください。 次に、相対パスを使用して特定の必要なファイルを参照します。 次に例を示します。

**セットアップのソース フォルダー:** *c:\testapp\v1.0*<br>
**ライセンス ファイル:** *c:\testapp\v1.0\licenses\license.txt*

相対パス *licenses\license.txt* を使用して *license.txt* ファイルを参照します。

## <a name="create-assign-and-monitor-a-win32-app"></a>Win32 アプリを作成、割り当て、および監視する

基幹業務 (LOB) アプリと同様に、Microsoft Intune に Win32 アプリを追加できます。 この種類のアプリは、通常は社内でまたはサード パーティによって記述されます。 

### <a name="process-flow-to-add-a-win32-app-to-intune"></a>Win32 アプリを Intune に追加するプロセス フロー

<img alt="Process flow to add a Win32 app to Intune" src="./media/apps-win32-app-management/add-win32-app.svg" width="500">

### <a name="add-a-win32-app-to-intune"></a>Win32 アプリを Intune に追加する

次の手順では、Intune に Windows アプリを追加するためのガイダンスを提供します。

1. [Microsoft Endpoint Manager 管理センター](https://go.microsoft.com/fwlink/?linkid=2109431)にサインインします。
2. **[アプリ]**  >  **[すべてのアプリ]**  >  **[追加]** の順に選択します。
3. **[アプリの種類の選択]** ペインの **[その他]** のアプリの種類で、 **[Windows アプリ (Win32)]** を選択します。

    > [!IMPORTANT]
    > Microsoft Win32 コンテンツ準備ツールの最新バージョンを使用してください。 最新バージョンを使用しない場合、アプリが以前のバージョンの Microsoft Win32 コンテンツ準備ツールを使用してパッケージ化されたことを示す警告が表示されます。 

4. **[選択]** をクリックします。 **[アプリの追加]** 手順が表示されます。

## <a name="step-1---app-information"></a>ステップ 1 - アプリ情報

### <a name="select-the-app-package-file"></a>アプリ パッケージ ファイルを選択する

1. **[アプリの追加]** ウィンドウで、 **[アプリ パッケージ ファイルの選択]** をクリックします。 
2. **[アプリのパッケージ ファイル]** ウィンドウで、参照ボタンを選択します。 次に、拡張子が *.intunewin* の Windows インストール ファイルを選択します。
   アプリの詳細が表示されます。
3. 操作を完了したら、 **[アプリ パッケージ ファイル]** ペインの **[OK]** を選択します。

### <a name="set-app-information"></a>アプリ情報を設定する

1. **[アプリ情報]** ページで、アプリの詳細を追加します。 選択したアプリによっては、このウィンドウ内の一部の値が自動的に入力されている場合があります。
    - **名前**:アプリの名前を入力します。これは会社のポータルに表示されます。 使用するアプリ名はすべて一意にします。 同じアプリ名が 2 つ存在する場合、いずれか 1 つのアプリのみが会社のポータルに表示されます。
    - **説明**:アプリの説明を入力します。 説明はポータル サイトに表示されます。
    - **[発行元]** : アプリの発行元の名前を入力します。
    - **[カテゴリ]** : 1 つまたは複数の組み込みアプリ カテゴリを選択するか、ご自身で作成したカテゴリを選択します。 カテゴリを使用すれば、ユーザーはポータル サイトを参照する際にアプリを見つけやすくなります。
    - **[会社のポータルでおすすめアプリとして表示します]** : ユーザーがアプリを参照するとき、会社のポータルのメイン ページにアプリが目立つように表示されます。
    - **[情報 URL]** : このアプリに関する情報が含まれる Web サイトの URL を入力することもできます。 この URL はポータル サイトに表示されます。
    - **[プライバシー URL]** : このアプリのプライバシー情報が含まれる Web サイトの URL を入力することもできます。 この URL はポータル サイトに表示されます。
    - **[開発者]** : (省略可能) アプリ開発者の名前を入力します。
    - **[所有者]** : (省略可能) このアプリの所有者の名前を入力します。 たとえば、「**人事部**」と入力します。
    - **[メモ]** : このアプリに関連付けるメモを入力します。
    - **[ロゴ]** : アプリに関連付けるアイコンをアップロードします。 ユーザーが会社のポータルを参照するとき、アプリにアイコンが表示されます。
2. **[次へ]** をクリックして、 **[プログラム]** ページを表示します。

## <a name="step-2-program"></a>手順 2:プログラム

1. **[プログラム]** ページで、アプリのインストールと削除のコマンドを構成します。
    - **インストール コマンド**:アプリをインストールする完全なインストール コマンド ラインを追加します。 

        たとえば、アプリのファイル名が **MyApp123** の場合、以下を追加します。<br>
        `msiexec /p "MyApp123.msp"`<p>
        また、アプリケーションが `ApplicationName.exe` である場合、コマンドはアプリケーション名となり、その後に、パッケージでサポートされるコマンド引数 (スイッチ) が続きます。 <br>
        次に例を示します。<br>
        `ApplicationName.exe /quiet`<br>
        上記のコマンドでは、`ApplicationName.exe` パッケージで `/quiet` コマンド引数がサポートされます。<p> 
        アプリケーション パッケージでサポートされる特定の引数については、アプリケーション ベンダーにお問い合わせください。

        > [!IMPORTANT]
        > 管理者がコマンド ツールを使用する場合は、注意が必要です。 インストールとアンインストールのコマンド フィールドを使用すると、予期しないコマンドや有害なコマンドが渡される可能性があります。

    - **アンインストール コマンド**:完全なアンインストール コマンド ラインを追加し、アプリの GUID に基づいてアプリをアンインストールします。 

        次に例を示します。<br>
        `msiexec /x "{12345A67-89B0-1234-5678-000001000000}"`

    - **インストールの処理**:インストールの処理を **[システム]** または **[ユーザー]** に設定します。

        > [!NOTE]
        > Win32 アプリは、**ユーザー** コンテキストまたは**システム** コンテキストでインストールされるように構成できます。 **ユーザー** コンテキストでは、特定のユーザーのみが参照されます。 **システム** コンテキストでは、Windows 10 デバイスのすべてのユーザーが参照されます。
        >
        > エンド ユーザーは、Win32 アプリをインストールするためにデバイスにログインする必要はありません。
        > 
        > Win32 アプリのインストールとアンインストールは、アプリがユーザー コンテキストでインストールするように設定されていて、デバイスのエンド ユーザーが管理特権を持っている場合、(既定では) 管理特権で実行されます。
    
    - **デバイスの再起動**: 次のいずれかのオプションを選択します。
        - **リターン コードを基に動作を決定する**:リターン コードに基づいてデバイスを再起動するには、このオプションを選択します。
        - **何もしない**:MSI ベース アプリのアプリのインストール中にデバイスが再起動されないようにするには、このオプションを選択します。
        - **アプリのインストールによるデバイスの強制的な再起動を許可する**: 再起動を抑制せずにアプリのインストールを完了できるようにするには、このオプションを選択します。
        - **Intune によってデバイスの必須の再起動が強制実行されるようにする**: アプリが正常にインストールされた後、常にデバイスを再起動するには、このオプションを選択します。

    - **インストール後の動作を示すリターン コードを指定します**:アプリのインストールの再試行動作またはインストール後の動作を指定するために使用するリターン コードを追加します。 リターン コードのエントリは、アプリの作成時に既定で追加されます。 ただし、リターン コードをさらに追加したり、既存のリターン コードを変更したりできます。
        1. **[コードの種類]** 列で、 **[コードの種類]** を次のいずれかに設定します。
            - **[失敗]** – アプリのインストールの失敗を示す戻り値。
            - **[ハード リブート]** – ハード リブートのリターン コードでは、再起動なしにクライアントに次の Win32 アプリをインストールすることはできません。 
            - **[ソフト リブート]** – ソフト リブートのリターン コードでは、クライアントを再起動しなくても次の Win32 アプリをインストールできます。 は、現在のアプリケーションのインストールを完了するには、再起動する必要があります。
            - **[再試行]** – 再試行のリターン コードのエージェントは、アプリのインストールを 3 回試行します。 各試行の間に 5 分間待機します。 
            - **[成功]** – アプリが正常にインストールされたことを示す戻り値。
        2. 必要に応じて、 **[追加]** をクリックしてリターン コードを追加するか、既存のリターン コードを変更します。
2. **[次へ]** をクリックして **[要件]** ページを表示します。        

## <a name="step-3-requirements"></a>手順 3:要件

1. **[要件]** ページで、アプリをインストールする前にデバイスが満たす必要のある要件を指定します。
    - **[オペレーティング システムのアーキテクチャ]** :アプリをインストールするために必要なアーキテクチャを選択します。
    - **[最低限のオペレーティング システム]** :アプリをインストールするために必要な最低限のオペレーティング システムを選択します。
    - **[必要なディスク領域 (MB)]** :必要に応じて、アプリをインストールするためにシステム ドライブで必要な空きディスク領域を追加します。
    - **[必要な物理メモリ (MB)]** :必要に応じて、アプリをインストールするために必要な物理メモリ (RAM) を追加します。
    - **[必要な論理プロセッサの最小数]** :必要に応じて、アプリをインストールするために必要な論理プロセッサの最小数を追加します。
    - **[必要な最小 CPU 速度 (MHz)]** :必要に応じて、アプリをインストールするために必要な最小 CPU 速度を追加します。
    - **追加の要件規則を構成する**: 
        1. **[追加]** をクリックして、 **[要件規則の追加]** ウィンドウを表示し、追加の要件規則を構成します。 **[要件の種類]** を選択し、要件の検証方法を決定するために使用する規則の種類を選びます。 要件規則は、ファイル システム情報、レジストリ値、または PowerShell スクリプトをベースにすることができます。 
            - **ファイル**: **[要件の種類]** として **[ファイル]** を選択した場合、要件規則でファイルまたはフォルダー、日付、バージョン、あるいはサイズを検出する必要があります。 
                - **[パス]** – 検出するファイルまたはフォルダーが含まれるフォルダーの完全なパス。
                - **[ファイル名またはフォルダー名]** - 検出するファイルまたはフォルダー。
                - **[プロパティ]** – アプリの存在を検証するために使用される規則の種類を選択します。
                - **[Associated with a 32-bit app on 64-bit clients]\(64 ビット クライアントの 32 ビット アプリに関連している\)** - **[はい]** を選択すると、64 ビット クライアントの 32 ビットのコンテキストで任意のパス環境変数が展開されます。 **[いいえ]** (既定) を選択すると、64 ビット クライアントの 64 ビットのコンテキストで任意のパス変数が展開されます。 32 ビット クライアントは、常に 32 ビットのコンテキストを使用します。
            - **レジストリ**: **[要件の種類]** として **[レジストリ]** を選択した場合、要件規則では、値、文字列、整数、またはバージョンに基づいてレジストリ設定を検出する必要があります。
                - **[キーのパス]** – 検出する値を含むレジストリ エントリの完全なパス。
                - **[値の名前]** - 検出するレジストリ値の名前。 この値が空の場合、検出はキーで実行されます。 検出方法がファイルまたはフォルダーの存在の確認以外である場合は、キーの (既定) 値が検出値として使用されます。
                - **[レジストリ キーの要件]** – 要件規則を検証する方法を決定するために使用される、レジストリ キーの比較の種類を選択します。
                - **[Associated with a 32-bit app on 64-bit clients]\(64 ビット クライアントの 32 ビット アプリに関連している\)** - **[はい]** を選択すると、64 ビット クライアントで 32 ビットのレジストリが検索されます。 **[いいえ]** (既定) を選択すると、64 ビット クライアントで 64 ビットのレジストリが検索されます。 32 ビット クライアントは、常に 32 ビットのレジストリを検索します。
            - **スクリプト**:ファイル、レジストリ、またはその他の Intune コンソールで使用可能な方法に基づいて、要件規則を作成できない場合は、 **[要件の種類]** として **[スクリプト]** を選択します。
                - **[スクリプト ファイル]** – PowerShell スクリプト ベースの要件規則では、終了コードが 0 である場合、STDOUT をさらに詳しく検出します。 たとえば、値が 1 の整数として STDOUT を検出できます。
                - **[64 ビット クライアントで 32 ビット プロセスとしてスクリプトを実行する]** - **[はい]** を選択すると、64 ビット クライアント上の 32 ビット プロセスでスクリプトが実行されます。 **[いいえ]** (既定値) を選択すると、64 ビット クライアント上の 64 ビット プロセスでスクリプトが実行されます。 32 ビット クライアントでは、32 ビット プロセスでスクリプトが実行されます。
                - **このスクリプトをログオンしたユーザーの資格情報を使用して実行する**: **[はい]** を選択すると、サインインしたデバイスの資格情報を使用してスクリプトが実行されます**。
                - **[スクリプト署名チェックを強制]** - **[はい]** を選択すると、信頼された発行元によってスクリプトが署名されていることを確認できます。これにより、警告もプロンプトも表示されることなくスクリプトを実行できます。 スクリプトはブロックされずに実行されます。 **[いいえ]** (既定) を選択すると、署名の確認なしに、エンド ユーザーの確認を使用してスクリプトが実行されます。
                - **[出力データの型を選択する]** :要件規則の一致を確認する際に使用されるデータ型を選択します。
        2. 要件規則の設定が完了したら、 **[OK]** を選択します。
2. **[次へ]** をクリックして、 **[検出規則]** ページを表示します。   

## <a name="step-4-detection-rules"></a>手順 4:検出規則

1. **[検出規則]** ページで、アプリの存在を検出するための規則を構成します。
    
    **規則の形式**:アプリの存在を検出する方法を選択します。 検出規則を手動で構成するか、またはカスタム スクリプトを使用してアプリの存在を検出することができます。 少なくとも 1 つの検出規則を選択する必要があります。 

    > [!NOTE]
    > **[検出規則]** ウィンドウで、複数の規則を選択して追加できます。 アプリを検出するには、**すべての**規則の条件を満たす必要があります。
    >
    > アプリがデバイスに存在しないことが Intune によって検出された場合、Intune では 24 時間後に再びアプリが提供されます。 これは、必須の意図で対象となっているアプリに対してのみ行われます。

    - **[検出規則を手動で構成する]** - 次の規則の種類のいずれかを選択できます。
        1. **[MSI]** – MSI のバージョンの確認に基づいて確認を行います。 このオプションは一度だけ追加できます。 この規則の種類を選択すると、次の 2 つの設定が表示されます。
            - **[MSI 製品コード]** – アプリの有効な MSI 製品コードを追加します。
            - **[MSI 製品のバージョンの確認]** – **[はい]** を選択すると、MSI 製品コードに加えて MSI 製品のバージョンを確認できます。
        2. **[ファイル]** – ファイルまたはフォルダーの検出、日付、バージョン、またはサイズに基づいて確認を行います。
            - **[パス]** – 検出するファイルまたはフォルダーが含まれるフォルダーの完全なパス。
            - **[ファイル名またはフォルダー名]** - 検出するファイルまたはフォルダー。
            - **[検出方法]** – アプリの存在を確認するために使用する検出方法の種類を選択します。
            - **[Associated with a 32-bit app on 64-bit clients]\(64 ビット クライアントの 32 ビット アプリに関連している\)** - **[はい]** を選択すると、64 ビット クライアントの 32 ビットのコンテキストで任意のパス環境変数が展開されます。 **[いいえ]** (既定) を選択すると、64 ビット クライアントの 64 ビットのコンテキストで任意のパス変数が展開されます。 32 ビット クライアントは、常に 32 ビットのコンテキストを使用します。
            
            **ファイル ベースの検出の例**
            1. ファイルが存在するかどうかを確認します。
         
                ![[検出規則] ウィンドウ - ファイルの存在を確認する場合のスクリーンショット](./media/apps-win32-app-management/apps-win32-app-03.png)
        
            2. フォルダーが存在するかどうかを確認します。
         
                ![[検出規則] ウィンドウ - フォルダーの存在を確認する場合のスクリーンショット](./media/apps-win32-app-management/apps-win32-app-04.png)
        
        3. **[レジストリ]** – 値、文字列、整数、またはバージョンに基づいて確認を行います。
            - **[キーのパス]** – 検出する値を含むレジストリ エントリの完全なパス。
            - **[値の名前]** - 検出するレジストリ値の名前。 この値が空の場合、検出はキーで実行されます。 検出方法がファイルまたはフォルダーの存在の確認以外である場合は、キーの (既定) 値が検出値として使用されます。
            - **[検出方法]** – アプリの存在を確認するために使用する検出方法の種類を選択します。
            - **[Associated with a 32-bit app on 64-bit clients]\(64 ビット クライアントの 32 ビット アプリに関連している\)** - **[はい]** を選択すると、64 ビット クライアントで 32 ビットのレジストリが検索されます。 **[いいえ]** (既定) を選択すると、64 ビット クライアントで 64 ビットのレジストリが検索されます。 32 ビット クライアントは、常に 32 ビットのレジストリを検索します。
            
            **レジストリ ベースの検出の例**
            1. レジストリ キーが存在するかどうかを確認します。
            
                ![[検出規則] ウィンドウ - レジストリ キーの存在を確認する場合のスクリーンショット](./media/apps-win32-app-management/apps-win32-app-05.png)    
            
            2. レジストリ値が存在することを確認します。
        
                ![[検出規則] ウィンドウ - レジストリ値の存在を確認する場合のスクリーンショット](./media/apps-win32-app-management/apps-win32-app-06.png)    
        
            3. レジストリ値の文字列が等しいかどうかを確認します。
        
                ![[検出規則] ウィンドウ - レジストリ値の文字列が等しいかどうかを確認する場合のスクリーンショット](./media/apps-win32-app-management/apps-win32-app-07.png)    
     
    - **[Use a custom detection script]\(カスタムの検出スクリプトを使用する\)** – このアプリを検出するために使用する PowerShell スクリプトを指定します。 
    
       1. **[スクリプト ファイル]** – クライアントでアプリの存在を検出する PowerShell スクリプトを選択します。 スクリプトが値 0 の終了コードを返し、さらに STDOUT に文字列値を書き込むと、アプリが検出されます。

       2. **[64 ビット クライアントで 32 ビット プロセスとしてスクリプトを実行する]** - **[はい]** を選択すると、64 ビット クライアント上の 32 ビット プロセスでスクリプトが実行されます。 **[いいえ]** (既定値) を選択すると、64 ビット クライアント上の 64 ビット プロセスでスクリプトが実行されます。 32 ビット クライアントでは、32 ビット プロセスでスクリプトが実行されます。

       3. **[スクリプト署名チェックを強制]** - **[はい]** を選択すると、信頼された発行元によってスクリプトが署名されていることを確認できます。これにより、警告もプロンプトも表示されることなくスクリプトを実行できます。 スクリプトはブロックされずに実行されます。 **[いいえ]** (既定) を選択すると、署名の確認なしに、エンド ユーザーの確認を使用してスクリプトが実行されます。
    
            Intune エージェントによってスクリプトの結果が確認されます。 スクリプトによって標準出力 (STDOUT) ストリーム、標準エラー (STDERR) ストリーム、および終了コードに書き込まれた値を読み取ります。 スクリプトがゼロではない値で終了した場合、スクリプトは失敗しており、アプリケーション検出の状態は "未インストール" になります。 終了コードがゼロで、STDOUT にデータがある場合、アプリケーション検出状態は "インストール済み" になります。 

            > [!NOTE]
            > スクリプトを UTF-8 としてエンコードすることをお勧めします。 スクリプトが値 0 で終了した場合、スクリプトの実行は成功しました。 2 番目の出力チャネルは、アプリが検出されたことを示します。STDOUT データは、クライアントでアプリが見つかったことを示します。 STDOUT から特定の文字列を検索することはありません。

2. 規則を追加したら、 **[次へ]** を選択して **[依存関係]** ページを表示します。

## <a name="step-5-dependencies"></a>手順 5:の依存関係

アプリ間の依存関係は、Win32 アプリをインストールする前にインストールする必要があるアプリケーションです。 依存関係として他のアプリがインストールされるように要求できます。 つまり、デバイスで Win32 アプリをインストールする前に、依存するアプリをインストールする必要があります。 最大 100 個の依存関係があり、これらには、アプリ自体だけでなく、含まれるすべての依存関係の依存関係が含まれます。 Win32 アプリ間の依存関係は、Win32 アプリが追加され、Intune にアップロードされた後にのみ追加できます。 Win32 アプリが追加されたら、Win32 アプリ用のウィンドウに **[依存関係]** オプションが表示されます。 

Win32 アプリの依存関係もまた、Win32 アプリである必要があります。 単一の MSI LOB アプリやストア アプリなど、その他のアプリの種類への依存関係はサポートされていません。

アプリ間の依存関係を追加する場合、アプリ名と発行元に基づいて検索できます。 さらに、アプリ名と発行元に基づいて、追加された依存関係を並べ替えることができます。 以前追加されたアプリ間の依存関係を、追加されたアプリ間の依存関係リストで選択することはできません。 

依存するアプリをそれぞれ自動的にインストールするかどうかを選ぶことができます。 既定では、各依存関係に対して、 **[自動インストール]** オプションが **[はい]** に設定されます。 依存するアプリを自動インストールすることで、依存するアプリのターゲットがユーザーやデバイスでない場合でも、Win32 アプリをインストールする前に依存関係が満たされるように、Intune でデバイスにアプリがインストールされます。 依存関係では再帰的なサブ依存関係を持つことができ、メイン依存関係をインストールする前にサブ依存関係がそれぞれインストールされることに注意することが重要です。 さらに、依存関係のインストールでは、特定の依存関係レベルのインストール順序には従いません。

### <a name="select-the-dependencies"></a>依存関係を選択する

**[依存関係]** ページで、Win32 アプリをインストールする前にインストールする必要があるアプリケーションを選択します。
1. **[追加]** をクリックして、 **[依存関係の追加]** ペインを表示します。
3. 依存するアプリを追加したら、 **[選択]** をクリックします。
4. **[自動インストール]** 列で **[はい]** または **[いいえ]** を選び、依存するアプリを自動的にインストールするかどうかを選択します。
5. **[次 へ]** をクリックして **[スコープ タグ]** ページを表示します。

### <a name="understand-additional-dependency-details"></a>その他の依存関係の詳細を理解する

エンド ユーザーに Windows トースト通知が表示され、Win32 アプリのインストール プロセスの一部として、依存するアプリがダウンロードされて、インストールされることが示されます。 さらに、依存するアプリがインストールされていない場合は、一般的にエンド ユーザーに次の通知のいずれかが表示されます。
- 1 つまたは複数の依存するアプリをインストールできませんでした
- 1 つまたは複数の依存するアプリ要件が満たされていません
- 1 つまたは複数の依存するアプリでデバイスの再起動が保留中です

依存関係を**自動インストール**しないことにした場合、Win32 アプリのインストールは試行されません。 さらに、アプリのレポートでは、依存関係に `failed` というフラグが設定されたことが示され、エラーの理由も提供されます。 Win 32 アプリの[インストールの詳細](troubleshoot-app-install.md#win32-app-installation-troubleshooting)に示されるエラー (または警告) をクリックすることで、依存関係のインストール エラーを表示できます。

各依存関係では、Intune Win32 アプリの再試行ロジック (5 分待ってから 3 回インストールを試行する) とグローバル再評価スケジュールに従います。 また、依存関係は、デバイスへの Win32 アプリのインストール時にのみ、適用できます。 Win32 アプリのアンインストールで依存関係を適用することはできません。 依存関係を削除するには、依存関係リストの行の末尾にある依存するアプリの左側の省略記号 (3 つのドット) をクリックする必要があります。 

## <a name="step-6---select-scope-tags-optional"></a>手順 6 - スコープのタグを選択する (省略可能)
スコープのタグを使って、Intune のクライアント アプリの情報を表示できるユーザーを決定することができます。 スコープのタグの詳細については、[分散 IT のためのロールベースのアクセス制御とスコープのタグの使用](../fundamentals/scope-tags.md)に関するページをご覧ください。

1. **[スコープ タグを選択]** をクリックして、必要に応じてアプリのスコープ タグを追加します。 
2. **[次へ]** をクリックして、 **[割り当て]** ページを表示します。

## <a name="step-7---assignments"></a>手順 7 - 割り当て

アプリのグループ割り当てについて、 **[必須]** 、 **[登録済みデバイスで使用可能]** 、または **[アンインストール]** を選択することができます。 詳細については、「[ユーザーとデバイスを整理するためのグループを追加する](../fundamentals/groups-add.md)」と「[Microsoft Intune を使用してアプリをグループに割り当てる](apps-deploy.md)」を参照してください。

1. 特定のアプリについて、割り当ての種類を選択します。
    - **必須**:アプリは選択したグループのデバイスにインストールされます。
    - **[登録済みデバイスで使用可能]** :ユーザーはアプリをポータル サイト アプリまたはポータル Web サイトからインストールできます。
    - **アンインストール**: アプリは選択したグループのデバイスからアンインストールされます。
2. **[グループの追加]** をクリックし、このアプリを使用するグループを割り当てます。
3. **[グループの選択]** ペインで、ユーザーまたはデバイスに基づいて割り当てるものを選択します。
4. グループを選択したら、 **[エンド ユーザーの通知]** 、 **[可用性]** 、 **[インストールの期限]** を選択することもできます。 詳しくは、「[Win32 アプリの可用性と通知を設定する](apps-win32-app-management.md#set-win32-app-availability-and-notifications)」をご覧ください。
5. このアプリの割り当ての影響を受けないように、ユーザーのグループを除外する場合は、 **[モード]** 列の下の **[含む]** を選択します。 **[割り当ての編集]** ペインが表示されます。 **[モード]** を **[含む]** から **[含まれません]** に設定することができます。 **[OK]** をクリックして **[割り当ての編集]** ペインを閉じます。
6. **[アプリの設定]** セクションで、アプリの **[配信の最適化の優先度]** を選択します。 この設定により、アプリのコンテンツのダウンロード方法が決まります。 割り当てに基づき、バックグラウンド モードまたはフォアグラウンド モードでアプリのコンテンツをダウンロードできます。 
7. アプリの割り当ての設定を完了したら、 **[次へ]** をクリックして、 **[確認と作成]** ページを表示します。

## <a name="step-8---review--create"></a>手順 8 - 確認と作成

1. アプリに入力した値と設定を確認します。 アプリ情報が正しく構成されていることを確認します。
2. 完了したら、 **[作成]** をクリックしてアプリを Intune に追加します。

    基幹業務アプリの **[概要]** ブレードが表示されます。

この時点で、Intune に Win32 アプリを追加する手順が完了しました。 アプリの割り当てと監視については、「[Microsoft Intune を使用してアプリをグループに割り当てる](apps-deploy.md)」および「[Microsoft Intune でアプリの情報と割り当てを監視する](apps-monitor.md)」を参照してください。

## <a name="delivery-optimization"></a>配信の最適化

Windows 10 1709 以降のクライアントでは、Windows 10 クライアント上の配信最適化コンポーネントを使用して、Intune Win32 アプリ コンテンツがダウンロードされます。 配信の最適化では、既定で有効になるピア ツー ピア機能が提供されます。 配信の最適化エージェントを、割り当てに基づいてバックグラウンドまたはフォアグラウンド モードで Win32 アプリ コンテンツをダウンロードするように構成できます。 配信の最適化は、グループ ポリシーによって、Intune デバイス構成を使用して構成できます。 詳しくは、[Windows 10 の配信の最適化](https://docs.microsoft.com/windows/deployment/update/waas-delivery-optimization)に関するページをご覧ください。 

> [!NOTE]
> また、Microsoft 接続キャッシュ サーバーを Configuration Manager の配布ポイントにインストールして、Intune Win32 のアプリ コンテンツをキャッシュすることもできます。 詳細については、「Configuration Manager における Microsoft 接続済みキャッシュ」の「[Intune Win32 アプリのサポート](https://docs.microsoft.com/configmgr/core/plan-design/hierarchy/microsoft-connected-cache#bkmk_intune)」を参照してください。

## <a name="install-required-and-available-apps-on-devices"></a>デバイスに必須および利用可能なアプリをインストールする

エンド ユーザーには、必要なアプリのインストールと利用可能なアプリのインストールに対する Windows トースト通知が表示されます。 次の図は、デバイスが再起動されるまでアプリのインストールが完了しない、トースト通知の例を示します。 

![アプリのインストールのための Windows トースト通知のスクリーンショット](./media/apps-win32-app-management/apps-win32-app-08.png)    

次の図では、デバイスに対してアプリの変更が行われていることがエンド ユーザーに通知されます。

![アプリが変更されていることをユーザーに通知するスクリーンショット](./media/apps-win32-app-management/apps-win32-app-09.png)    

さらに、ポータル サイト アプリでは、エンド ユーザーに追加のアプリ インストール状態メッセージが表示されます。 Win32 依存関係機能には、次の条件が適用されます。
- アプリをインストールできませんでした。 管理者によって定義された依存関係が満たされませんでした。
- アプリは正常にインストールされましたが、再起動が必要です。
- アプリはインストールの処理中ですが、続行するには再起動が必要です。

## <a name="set-win32-app-availability-and-notifications"></a>Win32 アプリの可用性と通知を設定する
Win32 アプリの開始時刻と期限の時刻を構成できます。 開始時刻になると、Intune 管理拡張機能によってアプリのコンテンツのダウンロードが開始され、必須の意図に対してキャッシュされます。 期限時刻になると、アプリはインストールされます。 利用可能なアプリの場合、開始時刻では、アプリが会社のポータルに表示され、エンド ユーザーが会社のポータルにアプリを要求するとコンテンツがダウンロードされるようになる時点が示されます。 さらに、再起動の猶予期間を有効にすることもできます。 

> [!IMPORTANT]
> **[割り当て]** セクションの **[再起動の猶予期間]** 設定は、 **[プログラム]** セクションの **[デバイスの再起動]** が次のオプションのいずれかに設定されているときにのみ利用できます。
> - **リターン コードを基に動作を決定する**
> - **Intune によってデバイスの必須の再起動が強制実行されるようにする**

次の手順に従い、必須アプリの日付と時刻に基づいてアプリの可用性を設定します。

1. [Microsoft Endpoint Manager 管理センター](https://go.microsoft.com/fwlink/?linkid=2109431)にサインインします。
2. **[アプリ]**  >  **[すべてのアプリ]** を選択します。
3. 一覧から既存の **Windows アプリ (Win32)** を選択します。 
4. アプリ ペインで、 **[プロパティ]**  >  **[編集]** ( **[割り当て]** セクションの横にあります) を選択し、 **[必須]** の割り当ての種類の下にある **[グループの追加]** を選択します。 
   アプリの可用性は、割り当ての種類に基づいて設定できることに注意してください。 **[割り当ての種類]** では、 **[必須]** 、 **[登録済みデバイスで使用可能]** 、または **[アンインストール]** を指定できます。
5. **[グループの選択]** ペインでグループを選択し、アプリを割り当てるユーザーのグループを指定します。 

    > [!NOTE]
    > **[割り当ての種類]** オプションには、次のものが含まれます。<br>
    > - **必須**: **[すべてのユーザーに対してこのアプリを必須にします]** と **[すべてのデバイスでこのアプリを必須にします]** の一方または両方を選択できます。<br>
    > - **[登録済みデバイスで使用可能]** : **[登録済みデバイスを使用するすべてのユーザーがこのアプリを利用できるようにします]** を選択できます。<br>
    > - **アンインストール**: **[すべてのユーザーからこのアプリをアンインストールします]** と **[すべてのデバイスからこのアプリをアンインストールします]** の一方または両方を選択できます。

6. **[エンド ユーザーの通知]** オプションを変更するには、 **[すべてのトースト通知を表示する]** を選択します。
7. **[割り当ての編集]** ウィンドウで、 **[エンド ユーザーの通知]** を **[すべてのトースト通知を表示する]** に設定します。 **[エンド ユーザーの通知]** は、 **[すべてのトースト通知を表示する]** 、 **[コンピューターの再起動時にトースト通知を表示する]** 、または **[すべてのトースト通知を非表示にする]** に設定できることに注意してください。
8. **[アプリの可用性]** を **[特定の日付と時刻]** に設定し、日付と時刻を選択します。 この日付と時刻では、アプリをエンド ユーザー デバイスにいつダウンロードするかを指定します。 
9. **[アプリのインストール期限]** を **[特定の日付と時刻]** に設定し、日付と時刻を選択します。 この日付と時刻では、アプリをエンド ユーザー デバイスにいつインストールするかを指定します。 同じユーザーまたはデバイスに対して複数の割り当てが行われるときは、可能な最も早い日時に基づいて、アプリのインストール期限が設定されます。

10. **[再起動の猶予期間]** の隣の **[有効]** をクリックします。 再起動の猶予期間は、デバイスでアプリのインストールが完了するとすぐに開始されます。 無効にすると、警告なしでデバイスを再起動できます。 <br>次のオプションをカスタマイズできます。
    - **[デバイス再起動の猶予期間 (分)]** : 既定値は 1,440 分 (24 時間) です。 この値は、最大で 2 週間まで指定できます。
    - **[再起動が発生する前に再起動のカウントダウン ダイアログ ボックスが表示されるタイミングを選択します (分)]** : 既定値は 15 分です。
    - **[ユーザーが再起動の通知を一時停止できるようにする]** : **[はい]** または **[いいえ]** を選択できます。
        - **[一時停止の期間を選択します (分)]** : 既定値は 240 分 (4 時間) です。 一時停止の値を、再起動の猶予期間より大きくすることはできません。

11. **[レビューと保存]** をクリックします。

## <a name="toast-notifications-for-win32-apps"></a>Win32 アプリのトースト通知 
必要に応じて、アプリ割り当てごとに、エンド ユーザーにトースト通知が表示されるのを抑制することができます。 Intune で、 **[アプリ]**  >  **[すべてのアプリ]** を選択します。アプリを選択し、 **[割り当て]**  >  **[グループを含める]** を選択します。 

> [!NOTE]
> Intune 管理拡張機能がインストールされている Win32 アプリは、未登録デバイスではアンインストールされません。 管理者は、割り当ての除外を利用して、Win32 アプリを BYOD デバイスに提供しないようにすることができます。

## <a name="troubleshoot-win32-app-issues"></a>Win32 アプリの問題をトラブルシューティングする
クライアント コンピューター上のエージェント ログは、一般的に `C:\ProgramData\Microsoft\IntuneManagementExtension\Logs` にあります。 これらのログ ファイルを表示するには、`CMTrace.exe` を利用します。 詳細については、「[CMTrace](https://docs.microsoft.com/configmgr/core/support/cmtrace)」を参照してください。

![クライアント コンピューター上のエージェント ログのスクリーンショット](./media/apps-win32-app-management/apps-win32-app-10.png)    

> [!IMPORTANT]
> LOB Win32 アプリを適切にインストールして実行できるようにするには、マルウェア対策設定で、以下のディレクトリをスキャン対象から除外する必要があります。<p>
> **X64 クライアント コンピューターの場合**:<br>
> *C:\Program Files (x86)\Microsoft Intune Management Extension\Content*<br>
> *C:\windows\IMECache*
>  
> **X86 クライアント コンピューターの場合**:<br>
> *C:\Program Files\Microsoft Intune Management Extension\Content*<br>
> *C:\windows\IMECache*
>
> 詳細については、「[現在サポートされているバージョンの Windows を搭載しているエンタープライズ コンピューターでウイルス スキャンを行う場合の推奨事項](https://support.microsoft.com/help/822158/virus-scanning-recommendations-for-enterprise-computers)」を参照してください。

### <a name="detecting-the-win32-app-file-version-using-powershell"></a>PowerShell を使用する Win32 アプリ ファイルのバージョンの検出

Win32 アプリ ファイルのバージョンを検出するのが難しい場合は、以下の PowerShell コマンドの使用または変更を検討してください。

``` PowerShell

$FileVersion = [System.Diagnostics.FileVersionInfo]::GetVersionInfo("<path to binary file>").FileVersion
#The below line trims the spaces before and after the version name
$FileVersion = $FileVersion.Trim();
if ("<file version of successfully detected file>" -eq $FileVersion)
{
#Write the version to STDOUT by default
$FileVersion
exit 0
}
else
{
#Exit with non-zero failure code
exit 1
}
```

上記の PowerShell コマンドで、`<path to binary file>` 文字列を、Win32 アプリ ファイルへのパスに置き換えます。 パスの例は次のようになります。<br>
`C:\Program Files (x86)\Microsoft SQL Server Management Studio 18\Common7\IDE\ssms.exe`

また、`<file version of successfully detected file>` 文字列を、検出する必要があるファイルのバージョンに置き換えます。 ファイル バージョン文字列の例は、次のようになります。<br>
`2019.0150.18118.00 ((SSMS_Rel).190420-0019)`

Win32 アプリのバージョン情報を取得する必要がある場合は、次の PowerShell コマンドを使用できます。

``` PowerShell

[System.Diagnostics.FileVersionInfo]::GetVersionInfo("<path to binary file>").FileVersion

```

上記の PowerShell コマンドで、`<path to binary file>` をファイル パスに置き換えます。

### <a name="additional-troubleshooting-areas-to-consider"></a>検討すべき追加のトラブルシューティング領域
- ターゲットを確認して、デバイスにエージェントがインストールされていることを確認する - グループをターゲットとする Win32 アプリ、またはグループをターゲットとする PowerShell スクリプトは、セキュリティ グループのエージェントのインストール ポリシーを作成します。
- OS バージョンを確認する – Windows 10 1607 以降である必要があります。  
- Windows 10 SKU を確認する - Windows 10 S (S モードを有効にして実行されている Windows バージョン) では、MSI のインストールはサポートされていません。

Win32 アプリのトラブルシューティングについて詳しくは、「[Win32 アプリ インストールのトラブルシューティング](troubleshoot-app-install.md#win32-app-installation-troubleshooting)」を参照してください。

## <a name="next-steps"></a>次のステップ

- Intune にアプリを追加する方法の詳細については、「[Microsoft Intune にアプリを追加する](apps-add.md)」を参照してください。
