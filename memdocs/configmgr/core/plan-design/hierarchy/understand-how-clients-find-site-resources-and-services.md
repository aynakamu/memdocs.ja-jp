---
title: サイト リソースを検索する
titleSuffix: Configuration Manager
description: Configuration Manager クライアントがサービスの場所を使用してサイト リソースを検索する方法とタイミングについて説明します。
ms.date: 02/7/2017
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: ae72df4b-5f5d-4e19-9052-bda28edfbace
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 262234edbd6fac6973653ca6cac62853fde23b2d
ms.sourcegitcommit: 99084d70c032c4db109328a4ca100cd3f5759433
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/20/2020
ms.locfileid: "88700114"
---
# <a name="learn-how-clients-find-site-resources-and-services-for-configuration-manager"></a>クライアントが Configuration Manager のサイト リソースやサービスを検索する方法を理解する

*適用対象:Configuration Manager (Current Branch)*

Configuration Manager クライアントは、そのクライアントが使用するように指示されているサービスを提供する、通信可能なサイト システム サーバーの場所を特定するために、"*サービスの場所*" と呼ばれるプロセスを使用しています。 クライアントがサービスの場所を使用してサイト リソースを検索する方法とそのタイミングを理解すると、クライアント タスクを正しくサポートするようにサイトを構成することができます。 これらの構成では、サイトで Active Directory Domain Services (AD DS) や DNS などのドメインおよびネットワーク構成とやり取りをすることが必要になる場合があります。 または、より複雑な方法を構成することが必要になる場合があります。  

サービスを提供するサイト システムの役割の例は次のとおりです。

- クライアントのコア サイト システム サーバー。
- 管理ポイント。
- 配布ポイントやソフトウェア更新ポイントなど、クライアントが通信できる追加のサイト システム サーバー。  



##  <a name="fundamentals-of-service-location"></a><a name="bkmk_fund"></a> Fundamentals of service location  
 クライアントは、サービスの場所を使用して通信可能な管理ポイントを検索する際に、現在のネットワークの場所、通信プロトコル設定、割り当て済みサイトを評価します。  

**クライアントは、以下の操作を実行するために管理ポイントと通信します。**  
- 将来のサービスの場所のサイクル用の既知の管理ポイントのリスト ("*管理ポイント リスト*" と呼ばれる) を構築できるように、サイトの他の管理ポイントに関する情報をダウンロードする。  
- インベントリやステータスなどの構成の詳細をアップロードする。  
- クライアントに構成を設定し、インストールが可能または必要なソフトウェアや他の関連タスクについてクライアントに通知することができるポリシーをダウンロードする。  
- クライアントが使用するように構成されているサービスを提供する追加のサイト システムの役割に関する情報を要求する。 例として、クライアントがインストールできるソフトウェアの配布ポイントや、更新プログラムを取得できるソフトウェア更新ポイントがあります。  

**Configuration Manager クライアントが、サービスの場所要求を作成します。**  
- 継続操作中 25 時間ごと。  
- クライアントでネットワークの構成または場所の変更が検出された場合。  
- コンピューター (コア クライアント サービス) 上で**ccmexec.exe** サービスが開始された場合。  
- クライアントで、必要なサービスを提供するサイト システムの役割を特定する必要が生じた場合。  

**クライアントは、サイト システムの役割をホストするサーバーを検索しようとするときに**、サービスの場所を使用して、クライアントのプロトコル (HTTP または HTTPS) をサポートするサイト システムの役割を検索します。 既定では、クライアントは最も安全な方法を使用します。 次の点を考慮します。  

- HTTPS を使用するには、公開キー基盤 (PKI) を導入し、クライアントとサーバーに PKI 証明書をインストールする必要があります。 証明書の使用方法については、「[Configuration Manager での PKI 証明書の要件](../../../core/plan-design/network/pki-certificate-requirements.md)」を参照してください。  

- インターネット インフォメーション サービス (IIS) を使用し、クライアントからの通信をサポートするサイト システムの役割を展開する場合は、そのサイト システムにクライアントが接続するときに HTTP と HTTPS のどちらを使用するかを指定する必要があります HTTP を使用する場合は、署名と暗号化のオプションについても検討してください。 詳細については、[セキュリティの計画](../../../core/plan-design/security/plan-for-security.md)に関する記事の「[署名と暗号化の計画](../../../core/plan-design/security/plan-for-security.md#BKMK_PlanningForSigningEncryption)」を参照してください。  

##  <a name="service-location-and-how-clients-determine-their-assigned-management-point"></a><a name="BKMK_Plan_Service_Location"></a> サービスの場所とクライアントが割り当て済み管理ポイントを特定する方法  
クライアントが最初にプライマリ サイトへの割り当てを行うときは、そのサイトの既定の管理ポイントが選択されます。 プライマリ サイトは複数の管理ポイントをサポートしており、各クライアントが 1 つの管理ポイントを既定の管理ポイントとして個別に識別します。 その結果、既定の管理ポイントは、そのクライアントの割り当て済み管理ポイントとなります。 (クライアント インストール コマンドを使用して、インストール時にクライアントの割り当て済み管理ポイントを設定することもできます)。  

クライアントは、そのクライアントの現在のネットワークの場所および境界グループの構成に基づき、通信する管理ポイントを選択します。 割り当て済み管理ポイントがある場合でも、その管理ポイントをクライアントが使用するとは限りません。  

> [!NOTE]  
> クライアントは登録メッセージと特定のポリシー メッセージに対して常に割り当て済み管理ポイントを使用します。これは、他の通信がプロキシまたはローカル管理ポイントに送信される場合でも当てはまります。

優先管理ポイントを使用できます。 優先管理ポイントは、クライアントの割り当て済みサイトの管理ポイントであり、クライアントがサイト システム サーバーを見つけるために使用している境界グループに関連付けられています。 優先管理ポイントは、配布ポイントや状態移行ポイントを境界グループに関連付けるのと同じような方法で、境界グループにサイト システム サーバーとして関連付けられています。 階層の優先管理ポイントを有効にすると、クライアントは、割り当て済みサイトの管理ポイントを使用するときに、割り当て済みサイトの他の管理ポイントを使用する前に優先管理ポイントを使用しようとします。  

[管理ポイントのアフィニティ](/archive/blogs/jchalfant/management-point-affinity-added-in-configmgr-2012-r2-cu3)に関するブログの情報を使用して、管理ポイントのアフィニティを構成することもできます。 管理ポイントのアフィニティは、割り当て済み管理ポイントの既定の動作を上書きし、クライアントが特定の 1 つ以上の管理ポイントを使用できるようにします。  

クライアントは、管理ポイントへの接続が必要になるたびに、Windows Management Instrumentation (WMI) にローカルに格納している管理ポイント リストを確認します。 クライアントは、インストール時に最初の管理ポイント リストを作成します。 その後、クライアントは階層内の各管理ポイントの詳細でリストを定期的に更新します。  

クライアントはその管理ポイント リストで有効な管理ポイントを見つけられない場合、使用できる管理ポイントが見つかるまで、次のサービスの場所のソースを順に検索します。  

1.  管理ポイント  
2.  AD DS  
3.  DNS  
4.  WINS  

管理ポイントが見つかって接続に成功した後、クライアントは階層内で使用可能な管理ポイントの現在のリストをダウンロードして、そのローカル管理ポイント リストを更新します。 これは、ドメインに参加しているクライアントと参加していないクライアントに平等に適用されます。  

たとえば、インターネット上にある Configuration Manager クライアントがインターネットベースの管理ポイントに接続した場合、管理ポイントで、サイト内の使用可能なインターネットベースの管理ポイントのリストがそのクライアントに送信されます。 同様に、ドメインに参加しているクライアントまたはワークグループ内のクライアントは、使用できる管理ポイントのリストも受信します。  

インターネット用に構成されていないクライアントには、インターネットのみに接続する管理ポイントが提供されません。 インターネット用に構成されたワークグループ クライアントは、インターネットに接続する管理ポイントとのみ通信します。  

##  <a name="the-mp-list"></a><a name="BKMK_MPList"></a> 管理ポイント リスト  
管理ポイント リストは、クライアントが以前に特定した管理ポイントの優先順位リストであるため、クライアントのサービスの場所の優先ソースです。 このリストは、クライアントがリストを更新する際に、ネットワークの場所に基づいてクライアントごとにソートされてから、WMI にローカルに保存されます。  

### <a name="building-the-initial-mp-list"></a>最初の管理ポイント リストの作成  
クライアントのインストール時に、クライアントの最初の管理ポイント リストを作成するために次の規則が使用されます。  

- 最初のリストにはクライアントのインストール時に指定される管理ポイントが含まれます (**SMSMP**= または **/MP** オプションを使用する場合)。  
- クライアントは、発行された管理ポイントを AD DS にクエリします。 AD DS から特定されるようにするには、管理ポイントがクライアントの割り当て済みサイトにあり、クライアントと同じ製品バージョンである必要があります。  
- クライアントのインストール時に管理ポイントが指定されておらず、Active Directory スキーマが拡張されていない場合、クライアントは発行された管理ポイントについて DNS と WINS を確認します。  
- クライアントが最初のリストを作成するときに、階層内のいくつかの管理ポイントに関する情報が認識されていない場合があります。  

### <a name="organizing-the-mp-list"></a>管理ポイント リストの整理  
クライアントは、次の分類を使用して管理ポイントのリストを整理します。  

- **プロキシ**:セカンダリ サイトにある管理ポイント。  
- **ローカル**:サイト境界で定義されている、クライアントの現在のネットワークの場所に関連付けられているすべての管理ポイント。 境界については、次の情報にご注意ください。
  - クライアントが複数の境界グループに属している場合、ローカル管理ポイントのリストは、クライアントの現在のネットワークの場所を含むすべての境界の和集合から特定されます。  
  - 通常、ローカル管理ポイントは、クライアントがその境界グループを提供する管理ポイントがある別のサイトに関連付けられているネットワーク上にない限り、クライアントの割り当て済み管理ポイントのサブセットです。   


- **割り当て済み**:クライアントの割り当て済みサイトのサイト システムであるすべての管理ポイント。  

優先管理ポイントを使用できます。 サイトの、境界グループに関連付けられていない管理ポイントや、クライアントの現在のネットワークの場所に関連付けられた境界グループに含まれていない管理ポイントは、優先管理ポイントとは見なされません。 これらは、クライアントが利用可能な優先管理ポイントを識別できないときに使用されます。  

### <a name="selecting-a-management-point-to-use"></a>使用する管理ポイントの選択  
一般的な通信では、クライアントは、クライアントのネットワークの場所に基づいて、次の順序で分類からの管理ポイントの使用を試みます。  

1.  プロキシ  
2.  ローカル  
3.  割り当て済み  

ただし、他の通信がプロキシまたはローカル管理ポイントに送信される場合でも、クライアントは登録メッセージと特定のポリシー メッセージに対して常に割り当て済み管理ポイントを使用します。  

各分類 (プロキシ、ローカル、または割り当て済み) 内で、クライアントは、次の優先順で管理ポイントの使用を試みます。  

1.  信頼されているフォレストまたはローカル フォレストで HTTPS 対応 (HTTPS 通信用にクライアントが構成されている場合)  
2.  信頼されているフォレストまたはローカル フォレスト以外で HTTPS 対応 (HTTPS 通信用にクライアントが構成されている場合)  
3.  信頼されているフォレストまたはローカル フォレストで HTTP 対応  
4.  信頼されているフォレストまたはローカル フォレスト以外で HTTP 対応  

優先順にソートされた一連の管理ポイントから、クライアントはリストの最初の管理ポイントの使用を試みます。 管理ポイントのソートされたリストはランダムであり、順序付けできません。 リストの順序は、クライアントがその管理パック リストを更新するたびに変わる場合があります。  

クライアントは、最初の管理ポイントとの接続を確立できない場合に、リスト上の連続する各管理ポイントを試みます。 優先されていない管理ポイントを試す前に、分類内の各優先管理ポイントを試みます。 クライアントは、分類内の管理ポイントと正常に通信できない場合、使用する管理ポイントが見つかるまで、次の分類の優先管理ポイントとの通信を試みます。  

クライアントは、管理ポイントとの通信を確立した後、次の状態になるまでその同じ管理ポイントを使用し続けます。  

- 25 時間が経過した。  
- クライアントが 10 分の期間にわたって 5 回の試行中に管理ポイントと通信できない。

その後、クライアントは使用する新しい管理ポイントをランダムに選択します。  

##  <a name="active-directory"></a><a name="bkmk_ad"></a> Active Directory  
ドメインに参加しているクライアントは、サービスの場所として AD DS を使用できます。 この場合、 [データを Active Directory に発行する](../../servers/deploy/configure/publish-site-data.md)ためのサイトが必要になります。  

次のすべての条件に該当する場合、クライアントはサービスの場所として AD DS を使用できます。  

- Active Directory [スキーマが拡張されている](../network/extend-the-active-directory-schema.md)、または System Center 2012 Configuration Manager用に拡張された。  
- [Active Directory フォレストが発行用に構成されており](../../servers/deploy/configure/publish-site-data.md)、Configuration Manager サイトが発行するように構成されている。  
- クライアント コンピューターが Active Directory ドメインのメンバーであり、グローバル カタログ サーバーにアクセスできる。  

クライアントは、AD DS からサービスの場所として使用する管理ポイントを見つけられない場合、DNS の使用を試みます。  

##  <a name="dns"></a><a name="bkmk_dns"></a> DNS  
イントラネット上のクライアントは、サービスの場所として DNS を使用できます。 この場合、DNS に管理ポイントに関する情報を発行するためのサイトが階層内に少なくとも 1 つは必要になります。  

次の条件のいずれかに該当する場合は、サービスの場所として DNS の使用を検討してください。
- AD DS スキーマが Configuration Manager 用に拡張されていない。
- イントラネットのクライアントが、Configuration Manager からデータを発行できないフォレストに配置されている。  
- クライアントがワークグループ コンピューターにあり、インターネット専用クライアント管理向けに構成されていない。 (インターネット用に構成されたワークグループ クライアントはインターネットに接続する管理ポイントとのみ通信し、サービスの場所として DNS を使用しません。)  
- [DNS から管理ポイントを検索するようにクライアントを構成](../../clients/deploy/configure-client-computers-to-find-management-points-by-using-dns-publishing.md)できます。  

サイトで DNS に管理ポイントのサービスの場所レコードを発行する場合:  

- 発行は、イントラネットからのクライアント接続を受け入れる管理ポイントにのみ適用できます。  
- 発行時に、管理ポイント コンピューターの DNS ゾーンにサービスの場所リソース レコード (SRV RR) が追加されます。 DNS には、そのコンピューターに対応するホスト エントリがなければなりません。  

既定では、ドメインに参加しているクライアントは、DNS でクライアントのローカル ドメインの管理ポイント レコードを検索します。 DNS に発行された管理ポイント情報があるドメインのドメイン サフィックスを指定するクライアント プロパティを構成することができます。  

クライアントの DNS サフィックスのプロパティを構成する方法については、[DNS 発行を使用して、管理ポイントを検出するようにクライアント コンピューターを構成する方法](../../../core/clients/deploy/configure-client-computers-to-find-management-points-by-using-dns-publishing.md)に関する記事を参照してください。  

クライアントは、DNS からサービスの場所として使用する管理ポイントを見つけられない場合、WINS の使用を試みます。  

### <a name="publish-management-points-to-dns"></a>管理ポイントを DNS に発行する  
管理ポイントを DNS に発行するには、次の 2 つの条件を満たさなければなりません。  

- DNS サーバーに、バージョン 8.1.2 以上の BIND がインストールされ、サービスの場所のリソース レコードを取り扱うことができる。  
- Configuration Manager 内の管理ポイント用に指定されたイントラネット FQDN に DNS のホスト エントリ (たとえば A レコード) がある。  

> [!IMPORTANT]  
> Configuration Manager の DNS 発行では、不整合のある名前空間はサポートされません。 不整合のある名前空間が存在する場合、手動で DNS に管理ポイントを発行するか、このセクションで説明している別のサービスの場所検出方法のいずれかを使用できます。  

**DNS サーバーが自動更新をサポートしている場合は**、イントラネットの管理ポイントが DNS に自動的に発行されるように Configuration Manager を構成することも、これらのレコードを DNS に手動で発行することもできます。 DNS に管理ポイントが発行されると、そのイントラネット FQDN とポート番号がサービスの場所 (SRV) レコードで公開されます。 サイトの管理ポイント コンポーネント プロパティで、サイトでの DNS 発行を構成します。 詳細については、「[Configuration Manager のサイト コンポーネント](../../../core/servers/deploy/configure/site-components.md)」を参照してください。  

**DNS ゾーンが動的更新に対して "セキュアのみ" に設定されている場合**、DNS に発行する最初の管理ポイントのみを既定のアクセス許可で正常に動的更新できます。

正常に発行してその DNS レコードを変更できるのが 1 つの管理ポイントのみで、その管理ポイント サーバーが正常である場合、クライアントはその管理ポイントから完全な管理ポイント リストを取得し、優先管理ポイントを検索できます。


**DNS サーバーが自動更新をサポートしていないが、サービスの場所レコードをサポートする場合は**、管理ポイントを DNS に手動で発行することができます。 このためには、サービスの場所リソース レコード (SRV RR) を DNS で手動で指定する必要があります。  

Configuration Manager では、サービスの場所レコードとして RFC 2782 がサポートされます。 これらのレコードは次の形式です: *_Service._Proto.Name TTL Class SRV Priority Weight Port Target*  

Configuration Manager に管理ポイントを発行するには、次の値を指定します。  

- **_Service**: **_mssms_mp**_&lt;サイトコード\> と入力します。&lt;サイトコード\> は、管理ポイントのサイト コードです。  
- **._Proto**: **._tcp** を指定します。  
- **.Name**:管理ポイントの DNS サフィックスを入力します (例: **contoso.com**)。  
- **TTL**:**14400** (4 時間) と指定します。  
- **Class**:**IN** を指定します (RFC 1035 に準拠)。  
- **優先順位**: Configuration Manager ではこのフィールドは使用されません。
- **Weight**:Configuration Manager ではこのフィールドは使用されません。  
- **Port**:管理ポイントで使用されるポート番号を指定します。たとえば、HTTP の場合は **80**、HTTPS の場合は **443** です。  

  > [!NOTE]  
  >  SRV レコードのポートは、管理ポイントで使用する通信ポートと一致する必要があります。 既定では、これは HTTP 通信の場合は **80**、HTTPS 通信の場合は **443** になります。  

- **Target**:管理ポイント サイトの役割が構成されているサイト システムに指定されているイントラネット FQDN を入力します。  

Windows Server DNS を使用する場合、次の手順に従って、イントラネット管理ポイントにこの DNS レコードを入力します。 DNS の別の実装を使用する場合、このセクションのフィールド値に関する情報を参考にし、その DNS のドキュメントを参照して、この手順を適合させます。  

##### <a name="to-configure-automatic-publishing"></a>自動発行を構成するには  

1.  Configuration Manager コンソールで、 **[管理]**  >  **[サイトの構成]**  >  **[サイト]** の順に展開します。  

2.  サイトを選択してから、 **[サイト コンポーネントの構成]** をクリックします。  

3.  **[管理ポイント]** を選択します。  

4.  発行する管理ポイントを選択します。 (この選択は、AD DS および DNS への発行に適用されます。)  

5.  DNS に発行するボックスをチェックします。 このボックスでは、  

    - DNS に発行する管理ポイントを選択できます。  

    - AD DS への発行は構成しません。  

##### <a name="to-manually-publish-management-points-to-dns-on-windows-server"></a>Windows Server の DNS に手動で管理ポイントを発行するには  

1.  Configuration Manager コンソールで、サイト システムのイントラネット FQDN を指定します。  

2.  DNS 管理コンソールで、管理ポイント コンピューターの DNS ゾーンを選択します。  

3.  サイト システムのイントラネット FQDN のホスト レコード (A または AAAA) があることを確認します。 このレコードが存在しない場合は作成します。  

4.  **[その他の新しいレコード]** オプションを使用して、 **[リソース レコードの種類]** ダイアログ ボックスの **[サービスの場所 (SRV)]** を選択して、 **[レコードの作成]** を選択し、次の情報を入力して、 **[完了]** を選択します。  

    - **ドメイン**: 必要に応じて、管理ポイントの DNS サフィックスを入力します (例: **contoso.com**)。  
    - **Service**:「 **_mssms_mp**_&lt;サイトコード\>」と入力します。&lt;サイトコード\> は管理ポイントのサイト コードです。  
    - **Protocol**:「 **_tcp**」と入力します。  
    - **優先順位**: Configuration Manager ではこのフィールドは使用されません。  
    - **Weight**:Configuration Manager ではこのフィールドは使用されません。  
    - **Port**:管理ポイントで使用されるポート番号を指定します。たとえば、HTTP の場合は **80**、HTTPS の場合は **443** です。  

      > [!NOTE]  
      > SRV レコードのポートは、管理ポイントで使用する通信ポートと一致する必要があります。 既定では、これは HTTP 通信の場合は **80**、HTTPS 通信の場合は **443** になります。  

    - **このサービスを提供しているホスト**:管理ポイント サイトの役割が構成されているサイト システムに指定されているイントラネット FQDN を入力します。  

DNS に発行するイントラネットの管理ポイントごとに、上記の手順を繰り返します。  

##  <a name="wins"></a><a name="bkmk_wins"></a> WINS  
他のサービスの場所が見つからない場合は、クライアントは WINS で接続する管理ポイントを探します。  

既定では、プライマリ サイトで、HTTP 用に構成されているサイトの最初の管理ポイントと HTTPS 用に構成されている最初の管理ポイントを WINS に発行します。  

クライアントが WINS で HTTP 管理ポイントを探さないようにする場合は、クライアントの CCMSetup.exe の Client.msi のプロパティで **SMSDIRECTORYLOOKUP=NOWINS**と指定します。