---
title: データベース レプリケーションの監視
titleSuffix: Configuration Manager
description: Configuration Manager 階層で SQL Server レプリケーションを監視する方法について説明します。
ms.date: 08/09/2019
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 69550b35-bcdb-4b47-bbec-b3c8bc92bb7b
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: 96cce5d4aaa352177b1c24ff78cf15e90ea6e823
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/21/2020
ms.locfileid: "81694410"
---
# <a name="monitor-database-replication"></a>データベース レプリケーションの監視

*適用対象:Configuration Manager (Current Branch)*

Configuration Manager コンソールの **[監視]** ワークスペースの **[データベースのレプリケーション]** ノードを使用して、データベース レプリケーションの詳細を監視します。 サイト間のレプリケーション リンクの状態を監視できます。 また、接続先のサイトのレプリケーション グループの初期化とレプリケーションについても示されます。  

> [!TIP]  
> **[データベースのレプリケーション]** ノードは **[管理]** ワークスペースの **[階層の構成]** ノードにも表示されますが、この場所からデータベース レプリケーション リンクのレプリケーション状態を表示することはできません。  

## <a name="replication-link-status"></a><a name="BKMK_MonitorReplicationLinks"></a> レプリケーション リンク ステータス  

サイト間のデータベース レプリケーションでは、"*レプリケーション グループ*" と呼ばれる、複数の情報セットがレプリケートされます。 各レプリケーション グループが異なる優先順位でデータを送受信します。 既定では、レプリケーション グループに含めるデータとレプリケーションの頻度は変更できません。  

レプリケーション リンクがアクティブであり、状態が失敗でも低化でもない場合、すべてのグループは迅速にレプリケートされます。 所定の時間内にレプリケートできなかったグループがある場合は、リンクが "*低化*" していると表示されます。 低化したリンクは引き続き機能しますが、監視して、アクティブな状態に戻ることを確認する必要があります。 それらを調査して、他の低化またはレプリケーションの失敗が発生しないようにします。  

レプリケーション リンクごとに、レプリケートが失敗したグループの再試行回数を指定します。 この再試行回数を過ぎると、サイトによってリンクの状態が "低下" または "失敗" に設定されます。 1 つを除いてすべてのグループが正常にレプリケートされた場合でも、サイトによってリンクの状態が "低下" または "失敗" に設定されます。 この状態が設定されるのは、1 つのレプリケーション グループが、指定された試行回数内でレプリケーションを完了できなかったためです。 詳細については、「[データベース レプリケーションのしきい値](../../plan-design/hierarchy/database-replication.md#BKMK_DBRepThresholds)」を参照してください。  

さらに調査が必要な可能性があるレプリケーション リンクの状態を理解するには、次の情報を使用してください。  

### <a name="link-is-active"></a>リンクはアクティブです

問題は検出されていません。リンク間の通信は最新の状態です。

親サイトが新しいバージョンに更新されているときに、子サイトからリンクの状態を表示すると、リンクの状態は "アクティブ" と表示されます。 更新後、子サイトが親サイトと同じバージョンになるまで、リンクの状態は親サイトでは "アクティブ" と表示されます。 子サイトから表示すると、"構成中" と表示されます。  

### <a name="link-is-degraded"></a>リンクが低速化しています

レプリケーションは機能していますが、少なくとも 1 つのレプリケーション オブジェクトまたはレプリケーション グループに遅延が生じています。 この状態にあるリンクを監視します。 リンクが失敗する兆候がないかどうか、リンクの両方のサイトの情報を確認します。

レプリケートされたデータを受信するサイトがデータベースにデータを迅速にコミットできない場合にも、リンクにステータス "低速化" が表示されることがあります。 この動作は、大容量のデータをレプリケートすると発生する可能性があります。 たとえば、多数のコンピューターにソフトウェア更新プログラムをデプロイしたとします。 リンクの親サイトでは、レプリケートされるデータの量を処理するために時間がかかる場合があります。 親サイトでの処理の遅延のため、親サイトでデータのバックログを正常に処理できるようになるまで、リンクの状態が "低化" に設定されます。

### <a name="link-has-failed"></a>リンクは正しく機能しませんでした

レプリケーションが機能していません。 何も措置を講じなくても、レプリケーション リンクが回復する可能性があります。 このリンクのレプリケーションを調査して修復するには、レプリケーション リンク アナライザー (RLA) を使用します。

また、このステータスが、レプリケーション リンクで親サイトと子サイト間の物理ネットワークに問題があることを示している可能性もあります。


## <a name="monitor-replication-status"></a><a name="BKMK_MonitorReplicationStatus"></a> レプリケーション状態の監視

**[監視]** ワークスペースの **[データベースのレプリケーション]** ノードを使用して、レプリケーション リンクの状態を表示します。 レプリケーション リンクの各サイトのデータベースの詳細が表示されます。 レプリケーション グループの詳細を表示することもできます。 これらの詳細を表示するには、レプリケーション リンクを選択してから、表示するレプリケーション状態の適切なタブを選択します。

次のセクションで、レプリケーション状態のさまざまなタブの詳細を説明します。

### <a name="summary"></a>[概要]

リンク上の 2 つのサイト間のサイト データとグローバル データのレプリケーションの概要を表示します。  

**[関連トラフィック データの履歴情報の表示]** を選択すると、リンクでレプリケーションに使用されたネットワーク帯域幅の詳細が表示されます。  

### <a name="parent-site"></a>親サイト

レプリケーション リンク上の親サイトのデータベースの詳細を表示します。次のものが含まれます。  

- SQL Server のファイアウォール ポート  

- ディスクの空き領域  

- データベース ファイルの場所  

- 証明書  

### <a name="child-site"></a>子サイト

レプリケーション リンク上の子サイトのデータベースの詳細を表示します。次のものが含まれます。  

- SQL Server のファイアウォール ポート  

- ディスクの空き領域  

- データベース ファイルの場所  

- 証明書  

### <a name="initialization-detail"></a>初期化の詳細

リンクでレプリケートされる、グループの初期化状態を表示します。 この情報を使用すると、レプリケーション データの初期化が進行中のときや失敗したときに、それを特定できます。  

この情報を使用すると、サイトが "*相互運用性モード*" になっているときに特定できます。 相互運用性モードになるのは、子サイトで親サイトと同じバージョンの Configuration Manager を実行していないときです。  

### <a name="replication-detail"></a>レプリケーションの詳細

リンクでレプリケートされる、各グループのレプリケーション状態を表示します。 この情報は、特定のデータのレプリケーションの問題や遅延を特定するために役立ちます。 これにより、このリンクのデータベース レプリケーションの適切なしきい値を決定できます。 詳細については、「[データベース レプリケーションのしきい値](../../plan-design/hierarchy/database-replication.md#BKMK_DBRepThresholds)」を参照してください。  

> [!TIP]  
> サイト データのレプリケーション グループは、子サイトからのみ親サイトに送信されます。 グローバル データのレプリケーション グループは、双方向でレプリケートされます。  


## <a name="replication-link-analyzer"></a><a name="BKMK_RLA"></a> レプリケーション リンク アナライザー

Configuration Manager には、レプリケーションの問題の分析と修復に使用する**レプリケーション リンク アナライザー** (RLA) が含まれています。 RLA を使用して、レプリケーションが失敗した際のリンクの失敗を修復します。 また、これは、レプリケーションの動作が停止したが、まだサイトによって "失敗" として報告されない場合にも役立ちます。

RLA を使用して、階層内の次のコンピューター間のレプリケーションの問題を修復します。  

- サイト サーバーとサイト データベース サーバー  

- あるサイトのサイト データベース サーバーと別のサイトのデータベース サーバー (サイト間レプリケーションとも呼ばれる)  

> [!Note]  
> レプリケーション失敗の方向は関係ありません。

RLA は、Configuration Manager コンソールまたはコマンド プロンプトで実行します。  

- Configuration Manager コンソールで実行するには、 **[監視]** ワークスペースに移動し、 **[データベースのレプリケーション]** ノードを選択します。 分析するレプリケーション リンクを選択してから、リボンで **[レプリケーション リンク アナライザー]** を選択します。  

- コマンド プロンプトで実行するには、コマンド「`%ProgramFiles(x86)%\Microsoft Configuration Manager\AdminConsole\bin\Microsoft.ConfigurationManager.ReplicationLinkAnalyzer.Wizard.exe <source site server FQDN> <destination site server FQDN>`」を入力します。  

RLA を実行すると、一連の診断規則とチェックに従って問題が検出されます。 ツールによって見つかった問題が表示されます。 問題を解決するための指示がある場合は表示されます。 RLA で自動的に問題を修復できる場合は、そのオプションが表示されます。

RLA の実行が終了すると、このツールを実行したユーザーのデスクトップに、次の XML ベースのレポートとログ ファイルが保存されます。  

- ReplicationAnalysis.xml  

- ReplicationLinkAnalysis.log  

修復している問題によっては RLA で次のサービスが停止されます。 修復が完了すると、それらのサービスは再起動されます。  

- SMS_SITE_COMPONENT_MANAGER  

- SMS_EXECUTIVE  

RLA が修復を完了できない場合は、必要に応じて、サイト サーバー上でこれらのサービスを再起動します。  

RLA では、すべての調査と修復アクションをログに記録され、ウィザードに表示されないその他の詳細情報が提供されます。  

### <a name="rla-prerequisites"></a>RLA の前提条件

RLA の実行に使用するアカウントには、次のアクセス許可がある必要があります。

- レプリケーション リンクに関係する各コンピューターのローカル管理者権限。

- レプリケーション リンクに関係する各 SQL Server データベースの sysadmin 権限。  

> [!Note]  
> このアカウントには、特定の Configuration Manager ロールベース管理セキュリティ ロールは必要ありません。 **[データベースのレプリケーション]** ノードにアクセスできる管理ユーザーは、Configuration Manager コンソールでツールを実行できます。 各コンピューターに対する十分な権限を持つシステム管理者は、コマンド プロンプトでツールを実行できます。  

### <a name="rla-known-issue"></a>RLA に関する既知の問題

RLA では、System Center 2012 Configuration Manager からアップグレードされたプライマリ サイトで SQL Server Service Broker (SSB) 証明書のエラーが発生します。 この問題の原因は、Configuration Manager の現在のブランチで証明書の名前が変更されたことです。 これらのエラーは無視してかまいません。  


## <a name="monitoring-database-replication"></a><a name="BKMK_ProcsforMonitoringReplication"></a> データベースのレプリケーションの監視  

### <a name="monitor-high-level-site-to-site-database-replication-status"></a>サイト間のデータベース レプリケーション状態の概要を監視する

1. Configuration Manager コンソールで、 **[監視]** ワークスペースに移動します。  

2. **[サイト階層]** ノードを選択し、 **[階層図]** ビューを開きます。  

3. 2 つのサイト間の線の上にマウス ポインターを置きます。 これらのサイトのグローバル データとサイト データのレプリケーションの状態が表示されます。  

### <a name="monitor-the-status-of-a-replication-link"></a>レプリケーション リンクの状態を監視する

1. Configuration Manager コンソールで、 **[監視]** ワークスペースに移動します。  

2. **[データベースのレプリケーション]** ノードを選択してから、監視するレプリケーション リンクを選択します。 次に、適切なタブを選択し、そのリンクのレプリケーション状態の各種詳細を表示します。  
