---
author: mestew
ms.author: mstewart
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: include
ms.date: 02/13/2020
ms.openlocfilehash: 767174ccbb63287ecc595d6e0c47ebc604e8103a
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/21/2020
ms.locfileid: "81693090"
---
## <a name="improvements-to-orchestration-groups"></a><a name="bkmk_orch"></a> オーケストレーション グループの機能強化
<!--3098816-->
オーケストレーション グループを作成すると、デバイスへのソフトウェア更新プログラムの展開をより細かく制御できます。 オーケストレーション グループを使用すると、割合や特定の数値、または明示的な順序に基づいて、デバイスを柔軟に更新できます。 また、デバイスで更新プログラムの展開を実行する前後に、PowerShell スクリプトを実行することもできます。

オーケストレーション グループは、"サーバー グループ" 機能の進化版です。 これらは [Configuration Manager の Technical Preview バージョン 1909](../../../2019/technical-preview-1909.md) で初めて導入されました。 [Technical Preview 2001](../../technical-preview-2001.md#bkmk_orch) と [Technical Preview 2001.2](../../technical-preview-2001-2.md#bkmk_orch) では、オーケストレーション グループが改善されました。 この Technical Preview で、オーケストレーション グループに次の機能強化を追加しました。

- オーケストレーションを再実行できるように、オーケストレーション グループ メンバーの * *[完了]* または *[失敗]* などの状態をクリアできます。
   - オーケストレーション グループ メンバーを右クリックし、 **[Reset Orchestration Group Member]\(オーケストレーション グループ メンバーのリセット\)** を選択します。
- 選択したメンバーに対して **[リソース エクスプローラー]** や **[詳細ログ記録を有効にする]** などの基本的な操作を開始できます。
- 再起動が必要な更新プログラムが、オーケストレーションで動作するようになりました。


[![オーケストレーション グループ メンバーのリセット](../../media/3098816-reset-og-member.png)](../../media/3098816-reset-og-member.png#lightbox)


### <a name="try-it-out"></a>試してみましょう。

タスクを実行してみます。 その後、[フィードバック](../../../../understand/find-help.md#product-feedback)で機能についてのご意見をお寄せください。

#### <a name="prerequisites"></a>[前提条件]

- すべてのオーケストレーション グループとそのグループに対する更新プログラムを表示するには、お使いのアカウントが **[完全な権限を持つ管理者]** である必要があります。
- **[オーケストレーション グループ]** 機能を有効にします。 詳細については、[オプション機能の有効化](../../../../servers/manage/install-in-console-updates.md#bkmk_options)に関するページをご覧ください。

    > [!NOTE]
    > **[オーケストレーション グループ]** を有効にすると、サイトによって **[サーバー グループ]** 機能が無効にされます。 この動作により、2 つの機能間の競合が回避されます。

#### <a name="create-an-orchestration-group"></a>オーケストレーション グループを作成する

1. Configuration Manager コンソールで、 **[資産とコンプライアンス]** ワークスペースに移動した後、 **[オーケストレーション グループ]** ノードを選択します。

1. リボンで **[オーケストレーション グループの作成]** を選択して、 **[オーケストレーション グループの作成ウィザード]** を開きます。

1. **[全般]** ページで、オーケストレーション グループの **[名前]** と、必要に応じて **[説明]** を指定します。 次の項目に対して使用する値を指定します。
   - **[The Orchestration Group timeout (in minutes)]\(オーケストレーション グループのタイムアウト (分)\)** :すべてのグループ メンバーが更新プログラムのインストールを完了するまでの制限時間です。
   - **[Orchestration Group member timeout (in minutes)]\(オーケストレーション グループ メンバーのタイムアウト (分)\)** :グループ内の 1 台のデバイスが更新プログラムのインストールを完了するまでの制限時間です。


1. **[メンバーの選択]** ページで、まず **[サイト コード]** を指定します。 次に、 **[追加]** を選択し、このオーケストレーション グループのメンバーとしてデバイス リソースを追加します。 名前でデバイスを **[検索]** した後、それらを **[追加]** します。 **[コレクションで検索]** を使用して、検索を単一のコレクションにフィルター処理することもできます。  選択したリソースの一覧へのデバイスの追加が完了したら、 **[OK]** を選択します。
   - グループのリソースを選択するときには、有効なクライアントのみが表示されます。 サイト コードを検証するためのチェックが行われ、クライアントがインストールされていること、およびリソースが重複していないことが確認されます。

1. **[ルール選択]** ページで、次のオプションのいずれかを選択します。

   - **[所定の割合のコンピューターの同時更新を許可する]** を選択した後、この割合の数値を選択または入力します。 この設定を使用すると、オーケストレーション グループのサイズに関する柔軟性をさらに高めることができます。 たとえば、オーケストレーション グループに 50 台のデバイスが含まれていて、この値を 10 に設定したとします。 ソフトウェア更新プログラムの展開中、Configuration Manager によって 5 台のデバイスで同時に展開を実行することが許可されます。 後でオーケストレーション グループのサイズを 100 台のデバイスに増やした場合、10 台のデバイスが一度に更新されます。

   - **[複数のコンピューターの同時更新を許可する]** を選択した後、この具体的なカウントに対する数を選択または入力します。 この設定を使用すると、オーケストレーション グループの全体的なサイズにかかわらず、常に特定の数のデバイスに制限できます。

   - **[メンテナンス シーケンスを指定する]** を選択した後、選択したリソースを適切な順序で並べ替えます。 この設定を使用すると、ソフトウェア更新プログラムの展開を実行するデバイスの順序を明示的に定義できます。

1. **[PreScript]** ページで、展開を実行する "*前に*" 各デバイス上で実行する PowerShell スクリプトを入力します。 このスクリプトは、成功した場合は `0` の値を返し、再起動を伴う成功に対しては `3010` を返す必要があります。 **[スクリプトのタイムアウト (秒)]** の値を指定します。これにより、指定した時間内に完了しなかったスクリプトが失敗します。

1. **[PostScript]** ページで、展開を実行した "*後に*" 各デバイス上で実行する PowerShell スクリプトと、 **[スクリプトのタイムアウト (秒)]** の値を入力します。 その動作は、その他の点では PreScript と同じです。

1. ウィザードを完了します。
1. グループの **[プロパティ]** を使用して、既存のオーケストレーション グループの設定を変更できます。 
1. オーケストレーション グループを削除するには、そのグループを選択してから、リボンの **[削除]** を選択します。

#### <a name="view-orchestration-groups-and-members"></a>オーケストレーション グループとメンバーの表示

**[資産とコンプライアンス]** ワークスペースから、 **[オーケストレーション グループ]** ノードを選択します。 メンバーを表示するには、オーケストレーション グループを選択し、リボンの **[メンバーの表示]** を選択します。 ノードで使用できる列の詳細については、[オーケストレーション グループとメンバーの監視](#bkmk_orch_monitor)に関する記事をご覧ください。


#### <a name="start-orchestration"></a>オーケストレーションの開始

- オーケストレーション グループのメンバーが含まれているコレクションに、[ソフトウェア更新プログラムを展開します](../../../../../sum/deploy-use/deploy-software-updates.md)。
   - メンテナンスの期限または期間中に、そのグループ内のクライアントがソフトウェア更新プログラムをインストールしようとすると、オーケストレーションが開始されます。 これはグループ全体に対して開始され、オーケストレーション グループのルールに従って確実にデバイスが更新されます。
- オーケストレーションを手動で開始するには、 **[オーケストレーション グループ]** ノードからオーケストレーションを選択し、リボンまたは右クリックのメニューから **[オーケストレーションの開始]** を選択します。  

> [!TIP]
> - オーケストレーション グループは、ソフトウェア更新プログラムの展開にのみ適用されます。 その他の展開には適用されません。
> - オーケストレーション グループ メンバーを右クリックし、 **[Reset Orchestration Group Member]\(オーケストレーション グループ メンバーのリセット\)** を選択することができます。 これにより、オーケストレーションを再実行できます。

#### <a name="monitoring"></a><a name="bkmk_orch_monitor"></a>  監査
Configuration Manager コンソールと[ログ ファイル](#log-files)を使用して、オーケストレーション グループとメンバーを監視できます。

##### <a name="monitor-orchestration-groups"></a>オーケストレーション グループを監視する

**[資産とコンプライアンス]** ワークスペースから、 **[オーケストレーション グループ]** ノードを選択します。 次の列のいずれかを追加して、グループに関する情報を取得します。

- **[オーケストレーション名]** :オーケストレーション グループの名前です。
- **サイト コード**: グループのサイト コードです。
- **[オーケストレーションの種類]** : 次の種類のいずれかです。
   - 数値
   - 割合
   - シーケンス

- **[オーケストレーションの値]** :ロックを同時に取得できるメンバーの数またはメンバーの割合です。 **[オーケストレーションの値]** が設定されるのは、 **[オーケストレーションの種類]** が *[数値]* 、 *[割合]* のどちらかである場合のみです。  
- **[オーケストレーションの状態]** :オーケストレーション中は [実行中] です。 実行中でない場合は [アイドル] です。
- **[Orchestration Start Time]\(オーケストレーション開始時刻\)** :オーケストレーションが開始された日付と時刻です。
- **[Current Sequence Number]\(現在のシーケンス番号\)** :グループのどのメンバーに対してオーケストレーションがアクティブであるかを示します。 この番号は、メンバーの **[シーケンス番号]** に対応します。  
- **[Orchestration Timeout (in minutes)]\(オーケストレーションのタイムアウト (分)\)** :グループの作成時に **[全般]** ページで設定した (または、グループの編集時に **[全般]** タブで設定した) **[The Orchestration Group timeout (in minutes)]\(オーケストレーション グループのタイムアウト (分)\)** の値です。
- **[Orchestration Group Member Timeout (in minutes)]\(オーケストレーション グループ メンバーのタイムアウト (分)\)** :グループの作成時に **[全般]** ページで設定した (または、グループの編集時に **[全般]** タブで設定した) **[Orchestration Group member timeout (in minutes)]\(オーケストレーション グループ メンバーのタイムアウト (分)\)** の値です。
- **[Orchestration Group ID]\(オーケストレーション グループ ID\)** :グループの ID です。この ID はログとデータベースで使用されます。
- **[Orchestration Group Unique ID]\(オーケストレーション グループの一意の ID\)** :グループの一意の ID です。この一意の ID はログとデータベースで使用されます。

##### <a name="monitor-orchestration-group-members"></a>オーケストレーション グループ メンバーを監視する

**[オーケストレーション グループ]** ノードで、オーケストレーション グループを選択します。 リボンで、 **[メンバーの表示]** を選択します。 グループのメンバーと、それぞれのオーケストレーションの状態を確認できます。 次の列のいずれかを追加して、メンバーに関する情報を取得します。

- **名前**:オーケストレーション グループ メンバーのデバイス名です
- **[現在の状態]** :メンバー デバイスの状態を示します。 
   - オーケストレーション中は **[実行中]** です。
   - **待機中**:クライアントが、更新プログラムをインストールする順番をロック上で待機していることを示します。 
   - オーケストレーションが完了したか、実行されていない場合は、 **[アイドル]** です。
- **[状態コード]** :オーケストレーション グループ メンバーを右クリックし、 **[Reset Orchestration Group Member]\(オーケストレーション グループ メンバーのリセット\)** を選択することができます。 このリセットにより、オーケストレーションを再実行できます。 次の状態があります。 
   - アイドル
   - 待機中 (デバイスは順番を待機しています)
   - 実行中 (更新プログラムのインストール中)
   - Failed
   - 再起動の保留中
- **[ロックの取得時間]** :ロックは、ポリシーに基づいてクライアントによって要求されます。 クライアントがロックを取得すると、その上でオーケストレーションがトリガーされます。  
- **[最終状態報告時間]** :メンバーが最後に状態を報告した時間です。
- **[シーケンス番号]** :更新プログラムをインストールするためのキュー内のクライアントの位置です。
- **サイト コード**: メンバーのサイト コードです。
- **[クライアント アクティビティ]** :クライアントがアクティブか非アクティブかを示します。
- **[プライマリ ユーザー]** :デバイスのプライマリ ユーザーです。
- **[クライアントの種類]** :クライアントのデバイスの種類です。
- **[現在ログオンしているユーザー]** :現在デバイスにログオンしているユーザーです。
- **[OG ID]** :メンバーが属しているオーケストレーション グループの ID です。 
- **[OG 一意の ID]** :メンバーが属しているオーケストレーション グループの一意の ID です。
- **[リソース ID]** :デバイスのリソース ID です。

#### <a name="log-files"></a>ログ ファイル
サイト サーバー上の次のログ ファイルを使用すると、監視およびトラブルシューティングに役立ちます。

##### <a name="site-server"></a>サイト サーバー
- **[Policypv.log]** : サイトがオーケストレーション グループを対象にしていることをクライアントに示します。
- **[SMS_OrchestrationGroup.log]** : オーケストレーション グループの動作を示します。

##### <a name="client"></a>クライアント

- **[MaintenanceCoordinator.log]** :ロックの取得、更新プログラムのインストール、事前および事後のスクリプト、およびロックの解放プロセスを示します。
- **[UpdateDeployment.log]** :更新プログラムのインストール プロセスを示します。
- **[PolicyAgent.log]** :クライアントがオーケストレーション グループに含まれているかどうかを確認します。 

#### <a name="orchestration-group-known-issues"></a>オーケストレーション グループに関する既知の問題

- 1 台のコンピューターを複数のオーケストレーション グループに追加しないでください。

