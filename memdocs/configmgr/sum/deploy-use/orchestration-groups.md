---
title: オーケストレーション グループ
titleSuffix: Configuration Manager
description: オーケストレーション グループを作成し、それに更新プログラムを展開します。
ms.date: 04/28/2020
ms.prod: configuration-manager
ms.technology: configmgr-sum
ms.topic: conceptual
ms.assetid: cddbebea-b418-4839-b0a8-7809486c8a4c
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: e9a307df23900abb985535b2ab59a5ff172cafb7
ms.sourcegitcommit: 0e62655fef7afa7b034ac11d5f31a2a48bf758cb
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/29/2020
ms.locfileid: "82254913"
---
# <a name="orchestration-groups-in-configuration-manager"></a>Configuration Manager のオーケストレーション グループ
<!--3098816-->
*適用対象:Configuration Manager (Current Branch)*

Configuration Manager バージョン 2002 以降では、オーケストレーション グループを作成できます。 オーケストレーション グループを作成して、デバイスへのソフトウェア更新プログラムの展開をより細かく制御します。 多くのサーバー管理者は、特定のワークロードの更新プログラムを慎重に管理し、中間の動作を自動化する必要があります。

オーケストレーション グループを使用すると、割合や特定の数値、または明示的な順序に基づいて、デバイスを柔軟に更新できます。 また、デバイスで更新プログラムの展開を実行する前後に、PowerShell スクリプトを実行することもできます。

サーバーだけでなく、任意の Configuration Manager クライアントをオーケストレーション グループのメンバーにすることができます。 オーケストレーション グループのルールは、オーケストレーション グループのメンバーを含むすべてのコレクションに対する、すべてのソフトウェア更新プログラムの展開について、デバイスに適用されます。 その他の展開の動作も引き続き適用されます。 たとえば、メメンテナンス期間や展開スケジュールなどです。

> [!NOTE]
> このバージョンの Configuration Manager では、オーケストレーション グループはプレリリース機能です。 これを有効にする場合は、「[プレリリース機能](../../core/servers/manage/pre-release-features.md)」を参照してください。  
>
> **[オーケストレーション グループ]** 機能は、[[サーバー グループ]](service-a-server-group.md) 機能の進化版です。 オーケストレーション グループは、Configuration Manager のオブジェクトです。

## <a name="orchestration-group-usage-example"></a>オーケストレーション グループの使用例

- あなたは、ソフトウェア更新プログラムの管理者として、組織のためのすべての更新プログラムを管理します。
- あなたは、すべてのサーバーに対する 1 つの大規模なコレクションと、すべてのクライアントに対する 1 つの大規模なコレクションを保持しています。 これらのコレクションにすべての更新プログラムを展開します。
- SQL 管理者は、SQL サーバーにインストールされているすべてのソフトウェアを制御したいと考えています。 5 台のサーバーに、特定の順序で修正プログラムを適用する必要があります。 現在のプロセスでは、特定のサービスを手動で停止してから更新プログラムをインストールし、その後でサービスを再起動しています。
- あなたはオーケストレーション グループを作成し、5 台の SQL サーバーをすべて追加します。 また、SQL 管理者によって提供される PowerShell スクリプトを使って、事前スクリプトと事後スクリプトも追加します。
- 次の更新サイクル中、あなたは通常どおりソフトウェア更新プログラムを作成して、大規模なサーバーのコレクションに展開します。 SQL 管理者が展開を実行すると、オーケストレーション グループによって順序とサービスが自動化されます。

## <a name="prerequisites"></a>[前提条件]

### <a name="site-server-and-permission-prerequisites"></a>サイト サーバーとアクセス許可の前提条件
- すべてのオーケストレーション グループとそのグループに対する更新プログラムを表示するには、お使いのアカウントが **[完全な権限を持つ管理者]** である必要があります。
   - 現在、オーケストレーション グループのロール ベース管理は使用できません。
- **[オーケストレーション グループ]** 機能を有効にします。 詳細については、[オプション機能の有効化](../../core/servers/manage/install-in-console-updates.md#bkmk_options)に関するページをご覧ください。
   - **[オーケストレーション グループ]** を有効にすると、サイトによって **[サーバー グループ]** 機能が無効にされます。 この動作により、2 つの機能間の競合が回避されます。

### <a name="client-prerequisites"></a>クライアントに関する前提条件

- 対象のデバイスを、Configuration Manager クライアントの最新バージョンにアップグレードします。
- オーケストレーション グループのメンバーは、同じサイトに割り当てる必要があります。
- デバイスは、複数のオーケストレーション グループに含めることはできません。
   - 既にオーケストレーション グループに含まれているデバイスは、新しいメンバーを追加するときに選択できません。


## <a name="limitations"></a>制限事項

- 最大 1,000 人のオーケストレーション グループ メンバーを保持できます。
- オーケストレーション グループは相互運用性モードでは機能しません。 詳細については、「[異なるバージョンの Configuration Manager 間の相互運用性](../../core/plan-design/hierarchy/interoperability-between-different-versions.md#bkmk_mixed)」を参照してください。 <!--6389000-->
- ソフトウェア センターからユーザーが更新プログラムを開始した場合、オーケストレーションはバイパスされます。 <!--6362887-->

## <a name="server-groups-are-automatically-updated-to-orchestration-groups"></a>オーケストレーション グループへのサーバー グループの自動更新

**[オーケストレーション グループ]** 機能は、[[サーバー グループ]](service-a-server-group.md) 機能の進化版です。 Configuration Manager バージョン2002 以降をインストールし、サーバー グループを有効にしている場合、それらのサーバー グループはオーケストレーション グループに自動的に移行されます。

## <a name="create-an-orchestration-group"></a>オーケストレーション グループを作成する

1. Configuration Manager コンソールで、 **[資産とコンプライアンス]** ワークスペースに移動した後、 **[オーケストレーション グループ]** ノードを選択します。

1. リボンで **[オーケストレーション グループの作成]** を選択して、 **[オーケストレーション グループの作成ウィザード]** を開きます。

1. **[全般]** ページで、オーケストレーション グループの **[名前]** と、必要に応じて **[説明]** を指定します。 次の項目に対して使用する値を指定します。
   - **Orchestration Group timeout (in minutes) (オーケストレーション グループのタイムアウト (分))** :すべてのグループ メンバーが更新プログラムのインストールを完了するまでの制限時間です。
   - **[Orchestration Group member timeout (in minutes)]\(オーケストレーション グループ メンバーのタイムアウト (分)\)** :グループ内の 1 台のデバイスが更新プログラムのインストールを完了するまでの制限時間です。

1. **[メンバーの選択]** ページで、まず **[サイト コード]** を指定します。 次に、 **[追加]** を選択し、このオーケストレーション グループのメンバーとしてデバイス リソースを追加します。 名前でデバイスを **[検索]** した後、それらを **[追加]** します。 **[コレクションで検索]** を使用して、検索を単一のコレクションにフィルター処理することもできます。  選択したリソースの一覧へのデバイスの追加が完了したら、 **[OK]** を選択します。
   - グループのリソースを選択するときには、有効なクライアントのみが表示されます。 サイト コードを検証するためのチェックが行われ、クライアントがインストールされていること、およびリソースが重複していないことが確認されます。

1. **[ルール選択]** ページで、次のオプションのいずれかを選択します。

   - **[所定の割合のコンピューターの同時更新を許可する]** を選択した後、この割合の数値を選択または入力します。 この設定を使用すると、オーケストレーション グループのサイズに関する柔軟性をさらに高めることができます。 たとえば、オーケストレーション グループに 50 台のデバイスが含まれていて、この値を 10 に設定したとします。 ソフトウェア更新プログラムの展開中、Configuration Manager によって 5 台のデバイスで同時に展開を実行することが許可されます。 後でオーケストレーション グループのサイズを 100 台のデバイスに増やした場合、10 台のデバイスが一度に更新されます。

   - **[複数のコンピューターの同時更新を許可する]** を選択した後、この具体的なカウントに対する数を選択または入力します。 この設定を使用すると、オーケストレーション グループの全体的なサイズにかかわらず、常に特定の数のデバイスに制限できます。

   - **[メンテナンス シーケンスを指定する]** を選択した後、選択したリソースを適切な順序で並べ替えます。 この設定を使用すると、ソフトウェア更新プログラムの展開を実行するデバイスの順序を明示的に定義できます。

1. **[事前スクリプト]** ページで、展開を実行する "*前に*" 各デバイスで実行する PowerShell スクリプトを入力します。 このスクリプトは、成功した場合は `0` の値を返し、再起動を伴う成功に対しては `3010` を返す必要があります。

1. **[事後スクリプト]** ページで、展開を実行した "*後に*" 各デバイスで実行する PowerShell スクリプトを入力します。 その動作は、その他の点では PreScript と同じです。

1. ウィザードを完了します。

> [!WARNING]
> 事前スクリプトと事後スクリプトは、オーケストレーション グループに使用する前に必ずテストしてください。 事前スクリプトと事後スクリプトはタイムアウトしないため、オーケストレーション グループ メンバーのタイムアウトに達するまで実行されます。

## <a name="view-orchestration-groups-and-members"></a>オーケストレーション グループとメンバーの表示

**[資産とコンプライアンス]** ワークスペースから、 **[オーケストレーション グループ]** ノードを選択します。 メンバーを表示するには、オーケストレーション グループを選択し、リボンの **[メンバーの表示]** を選択します。 ノードで使用できる列の詳細については、[オーケストレーション グループとメンバーの監視](#bkmk_orch_monitor)に関する記事をご覧ください。

## <a name="edit-or-delete-an-orchestration-group"></a>オーケストレーション グループを編集または削除する

オーケストレーション グループを削除するには、それを選択し、リボンまたは右クリックメニューで **[削除]** をクリックします。 オーケストレーション グループを編集するには、それを選択し、リボンまたは右クリックメニューで **[プロパティ]** をクリックします。 次のタブから設定を変更します。

   - **全般**: 
      - **名前**:オーケストレーション グループの名前
      - **説明**:オーケストレーション グループの説明 (省略可能)
      - **Orchestration Group timeout (in minutes) (オーケストレーション グループのタイムアウト (分))** :すべてのグループ メンバーが更新プログラムのインストールを完了するまでの制限時間です。
      - **[Orchestration Group member timeout (in minutes)]\(オーケストレーション グループ メンバーのタイムアウト (分)\)** :グループ内の 1 台のデバイスが更新プログラムのインストールを完了するまでの制限時間です。

  - **メンバーの選択**:
     - **サイト コード**: オーケストレーション グループのサイトコードです。
     - **メンバー**: **[追加]** をクリックして、オーケストレーション グループの追加デバイスを選択 します。 選択したデバイスを削除するには、 **[削除]** をクリックします。

   - **ルールの選択**:
      - **[所定の割合のコンピューターの同時更新を許可する]** を選択した後、この割合の数値を選択または入力します。 この設定を使用すると、オーケストレーション グループのサイズに関する柔軟性をさらに高めることができます。 たとえば、オーケストレーション グループに 50 台のデバイスが含まれていて、この値を 10 に設定したとします。 ソフトウェア更新プログラムの展開中、Configuration Manager によって 5 台のデバイスで同時に展開を実行することが許可されます。 後でオーケストレーション グループのサイズを 100 台のデバイスに増やした場合、10 台のデバイスが一度に更新されます。
      - **[複数のコンピューターの同時更新を許可する]** を選択した後、この具体的なカウントに対する数を選択または入力します。 この設定を使用すると、オーケストレーション グループの全体的なサイズにかかわらず、常に特定の数のデバイスに制限できます。
      - **メンテナンス シーケンスを指定する**: 選択したリソースを適切な順序に並べ替えます。 この設定を使用すると、ソフトウェア更新プログラムの展開を実行するデバイスの順序を明示的に定義できます。

   - **事前スクリプト**: 
       - 展開を実行する "*前に*" 各デバイスで実行する PowerShell スクリプトを入力します。 このスクリプトは、成功した場合は `0` の値を返し、再起動を伴う成功に対しては `3010` を返す必要があります。
       
   - **事後スクリプト**:
      - 展開を実行した "*後に*" 各デバイスで実行する PowerShell スクリプトを入力します。 このスクリプトは、成功した場合は `0` の値を返し、再起動を伴う成功に対しては `3010` を返す必要があります。
   > [!WARNING]
   > 事前スクリプトと事後スクリプトは、オーケストレーション グループに使用する前に必ずテストしてください。 事前スクリプトと事後スクリプトはタイムアウトしないため、オーケストレーション グループ メンバーのタイムアウトに達するまで実行されます。


## <a name="start-orchestration"></a>オーケストレーションの開始

1. オーケストレーション グループのメンバーが含まれているコレクションに、[ソフトウェア更新プログラムを展開します](deploy-software-updates.md)。

1. メンテナンスの期限または期間中に、そのグループ内のクライアントがソフトウェア更新プログラムをインストールしようとすると、オーケストレーションが開始されます。 これはグループ全体に対して開始され、オーケストレーション グループのルールに従って確実にデバイスが更新されます。
1. オーケストレーションを手動で開始するには、 **[オーケストレーション グループ]** ノードからオーケストレーションを選択し、リボンまたは右クリックのメニューから **[オーケストレーションの開始]** を選択します。
1. オーケストレーション グループが "*失敗*" 状態の場合:
   1. オーケストレーションが失敗した原因を特定し、問題を解決します。
   1. [グループ メンバーのオーケストレーションの状態をリセットします](#bkmk_reset)。
   1. **[オーケストレーション グループ]** ノードで **[オーケストレーションの開始]** ボタンをクリックして、オーケストレーションを再始動します。
   [![オーケストレーションの開始](./media/3098816-start-orchestration.png)](./media/3098816-start-orchestration.png#lightbox)


> [!TIP]
> - オーケストレーション グループは、ソフトウェア更新プログラムの展開にのみ適用されます。 その他の展開には適用されません。
> - オーケストレーション グループ メンバーを右クリックし、 **[Reset Orchestration Group Member]\(オーケストレーション グループ メンバーのリセット\)** を選択することができます。 これにより、オーケストレーションを再実行できます。


## <a name="monitor-orchestration-groups"></a><a name="bkmk_orch_monitor"></a> オーケストレーション グループの監視

**[資産とコンプライアンス]** ワークスペースから、 **[オーケストレーション グループ]** ノードを選択します。 次の列のいずれかを追加して、グループに関する情報を取得します。

- **[オーケストレーション名]** :オーケストレーション グループの名前です。
- **サイト コード**: グループのサイト コードです。
- **[オーケストレーションの種類]** : 次の種類のいずれかです。
   - 数値
   - 割合
   - シーケンス

- **[オーケストレーションの値]** :ロックを同時に取得できるメンバーの数またはメンバーの割合です。 **[オーケストレーションの値]** が設定されるのは、 **[オーケストレーションの種類]** が *[数値]* 、 *[割合]* のどちらかである場合のみです。  
- **[オーケストレーションの状態]** :オーケストレーション中は [実行中] です。 実行中でない場合は [アイドル] です。
- **[Orchestration Start Time]\(オーケストレーション開始時刻\)** :オーケストレーションが開始された日付と時刻です。
- **[Current Sequence Number]\(現在のシーケンス番号\)** :グループのどのメンバーに対してオーケストレーションがアクティブであるかを示します。 この番号は、メンバーの **[シーケンス番号]** に対応します。  
- **[Orchestration Timeout (in minutes)]\(オーケストレーションのタイムアウト (分)\)** :グループの作成時に **[全般]** ページで設定した (または、グループの編集時に **[全般]** タブで設定した) **[The Orchestration Group timeout (in minutes)]\(オーケストレーション グループのタイムアウト (分)\)** の値です。
- **[Orchestration Group Member Timeout (in minutes)]\(オーケストレーション グループ メンバーのタイムアウト (分)\)** :グループの作成時に **[全般]** ページで設定した (または、グループの編集時に **[全般]** タブで設定した) **[Orchestration Group member timeout (in minutes)]\(オーケストレーション グループ メンバーのタイムアウト (分)\)** の値です。
- **[Orchestration Group ID]\(オーケストレーション グループ ID\)** :グループの ID です。この ID はログとデータベースで使用されます。
- **[Orchestration Group Unique ID]\(オーケストレーション グループの一意の ID\)** :グループの一意の ID です。この一意の ID はログとデータベースで使用されます。

## <a name="monitor-orchestration-group-members"></a>オーケストレーション グループ メンバーを監視する

**[オーケストレーション グループ]** ノードで、オーケストレーション グループを選択します。 リボンで、 **[メンバーの表示]** を選択します。 グループのメンバーと、それぞれのオーケストレーションの状態を確認できます。 次の列のいずれかを追加して、メンバーに関する情報を取得します。

- **名前**:オーケストレーション グループ メンバーのデバイス名です
- **[現在の状態]** :メンバー デバイスの状態を示します。
   - オーケストレーション中は **[実行中]** です。
   - **待機中**:クライアントが、更新プログラムをインストールする順番をロック上で待機していることを示します。
   - オーケストレーションが完了したか、実行されていない場合は、 **[アイドル]** です。
- **[状態コード]** :オーケストレーション グループ メンバーを右クリックし、 **[Reset Orchestration Group Member]\(オーケストレーション グループ メンバーのリセット\)** を選択することができます。 このリセットにより、オーケストレーションを再実行できます。 次の状態があります。 
   - アイドル
   - 待機中 (デバイスは順番を待機しています)
   - 実行中 (更新プログラムのインストール中)
   - Failed
   - 再起動の保留中
- **[ロックの取得時間]** :ロックは、ポリシーに基づいてクライアントによって要求されます。 クライアントがロックを取得すると、その上でオーケストレーションがトリガーされます。  
- **[最終状態報告時間]** :メンバーが最後に状態を報告した時間です。
- **[シーケンス番号]** :更新プログラムをインストールするためのキュー内のクライアントの位置です。
- **サイト コード**: メンバーのサイト コードです。
- **[クライアント アクティビティ]** :クライアントがアクティブか非アクティブかを示します。
- **[プライマリ ユーザー]** :デバイスのプライマリ ユーザーです。
- **[クライアントの種類]** :クライアントのデバイスの種類です。
- **[現在ログオンしているユーザー]** :現在デバイスにログオンしているユーザーです。
- **[OG ID]** :メンバーが属しているオーケストレーション グループの ID です。
- **[OG 一意の ID]** :メンバーが属しているオーケストレーション グループの一意の ID です。
- **[リソース ID]** :デバイスのリソース ID です。

## <a name="reset-the-orchestration-state-for-a-group-member"></a><a name="bkmk_reset"></a> グループ メンバーのオーケストレーションの状態をリセットする

グループ メンバーに対してオーケストレーションを再実行する場合は、"*完了*" や "*失敗*" などの状態をクリアできます。 状態をクリアするには、オーケストレーション グループ メンバーを右クリックし、 **[Reset Orchestration Group Member]\(オーケストレーション グループ メンバーのリセット\)** を選択します。 リボンの **[Reset Orchestration Group Member]\(オーケストレーション グループ メンバーのリセット\)** をクリックすることもできます。 状態をリセットする前に、クライアントを調べて、失敗した理由を確認し、見つかった問題を修正する必要があります。
   [![オーケストレーション グループ メンバーのリセット](./media/3098816-reset-group-member.png)](./media/3098816-reset-group-member.png#lightbox)

## <a name="log-files"></a>ログ ファイル

サイト サーバー上の次のログ ファイルを使用すると、監視およびトラブルシューティングに役立ちます。

### <a name="site-server"></a>サイト サーバー

- **[Policypv.log]** : サイトがオーケストレーション グループを対象にしていることをクライアントに示します。
- **[SMS_OrchestrationGroup.log]** : オーケストレーション グループの動作を示します。

### <a name="client"></a>クライアント

- **[MaintenanceCoordinator.log]** :ロックの取得、更新プログラムのインストール、事前および事後のスクリプト、およびロックの解放のプロセスを示します。
- **[UpdateDeployment.log]** :更新プログラムのインストール プロセスを示します。
- **[PolicyAgent.log]** :クライアントがオーケストレーション グループに含まれているかどうかを確認します。

## <a name="next-steps"></a>次のステップ

[ソフトウェア更新プログラムの展開](deploy-software-updates.md)