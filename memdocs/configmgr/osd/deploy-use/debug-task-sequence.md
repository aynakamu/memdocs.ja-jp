---
title: タスク シーケンスのデバッグ
titleSuffix: Configuration Manager
description: タスク シーケンス デバッグ ツールを使用して、タスク シーケンスのトラブルシューティングを行います。
ms.date: 11/29/2019
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: how-to
ms.assetid: 4b60b0e1-ffa4-4fd5-864e-70a0546c8b3b
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 99ed8232a74b038b9b1cde4af257353252454c2b
ms.sourcegitcommit: d225ccaa67ebee444002571dc8f289624db80d10
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/12/2020
ms.locfileid: "88125153"
---
# <a name="debug-a-task-sequence"></a>タスク シーケンスのデバッグ

*適用対象:Configuration Manager (Current Branch)*

<!--3612274-->

タスク シーケンス デバッガーは、バージョン 1906 以降に搭載されている新しいトラブルシューティング ツールです。 デバッグ モードでタスク シーケンスを小さなデバイスのコレクションに展開します。 これで、制御された方法でタスク シーケンスをステップ実行し、トラブルシューティングと調査に利用できるようになります。 現在、デバッガーはタスク シーケンス エンジンと同じデバイスで実行されるので、リモート デバッガーではありません。

> [!Note]  
> このバージョンの Configuration Manager では、タスク シーケンス デバッガーはプレリリース機能です。 これを有効にする場合は、「[プレリリース機能](../../core/servers/manage/pre-release-features.md)」を参照してください。  


## <a name="prerequisites"></a>[前提条件]

- ターゲット デバイス上の Configuration Manager クライアントを更新する

- ローカル **Administrators** グループのユーザーとして、ターゲット デバイスにサインインします。 デバッガーは、管理者に対してのみ実行されます。

- タスク シーケンスに関連付けられているブート イメージを更新し、最新のクライアント バージョンがあることを確認します。


## <a name="start-the-tool"></a>ツールの開始

1. Configuration Manager コンソールで、 **[ソフトウェア ライブラリ]** ワークスペースに移動し、 **[オペレーティング システム]** を展開して **[タスク シーケンス]** を選択します。

1. タスク シーケンスを選択します。 リボンの [配置] グループで、 **[デバッグ]** を選択します。

    > [!Tip]  
    > または、タスク シーケンスが展開されているコレクションまたはコンピューター オブジェクトの変数 **TSDebugMode** を `TRUE` に設定します。 この変数が設定されたデバイスに展開されているすべてのタスク シーケンスがデバッグモードになります。

1. デバッグ配置の作成 展開の設定は、通常のタスク シーケンスの展開と同じです。 詳細については、「 [Deploy a task sequence](deploy-a-task-sequence.md#process)」をご覧ください。

    > [!Note]  
    > 選択できるのは、デバッグ配置用の小さなコレクションだけです。 メンバーが 10 以下のデバイス コレクションのみが表示されます。

バージョン 1910 より、新しいタスク シーケンス変数 **TSDebugOnError** を使って、タスク シーケンスでエラーが返されたときに自動的にデバッガーを起動できます。<!-- 5012536 --> 詳しくは、「[タスク シーケンス変数 - TSDebugOnError](../understand/task-sequence-variables.md#TSDebugOnError)」をご覧ください。

## <a name="use-the-tool"></a>ツールを使用する

タスク シーケンスがデバイスで実行されると、次のスクリーンショットのようなタスク シーケンス デバッガー ウィンドウが開きます。

![タスク シーケンス デバッガーのスクリーンショット](media/3612274-tsdebug.png)

デバッガーには次のコントロールがあります。

- **手順**:*現在の*位置から、タスク シーケンスの次のステップのみを実行します。  

    > [!Note]  
    > タスク シーケンスがデバッグ モードのときにステップが致命的なエラーを返すと、タスク シーケンスは通常どおりには失敗しません。 この動作により、外部からの変更を行った後にステップを再試行するオプションが提供されます。

- **Run**:"*現在*" の位置から、通常最後となる次の "*ブレーク*" ポイントまで、またはステップが失敗した場合に、タスク シーケンスを実行します。 この操作を使用する前に、必ず **[Set Break] (ブレークの設定)** アクションでブレークポイントを設定します。

- **Set Current (現在値の設定)** :デバッガーでステップを選択してから、 **[Set Current]\(現在値の設定\)** を選択します。 このアクションで、*現在の*ポインターはそのステップに移動されます。 このアクションを使用して、ステップをスキップしたり前に戻ったりすることができます。  

    > [!Warning]  
    > シーケンスの現在の位置を変更したときに、デバッガーではステップの種類が考慮されません。 ステップによっては、後の手順で条件の評価に必要なタスク シーケンス変数が設定されることがあります。 実行順序が正しくない場合は、一部の手順が失敗するか、デバイスに重大な損害が生じる可能性があります。 このオプションはご自身の責任で使用してください。  

- **Set Break (ブレークの設定)** :デバッガーでステップを選択してから、 **[Set Break]\(ブレークの設定\)** を選択します。 このアクションで、デバッガーに*ブレーク* ポイントが追加されます。 タスク シーケンスの **[Run]\(実行\)** を行うと、*ブレーク*で停止します。  

    - **[Run] (実行)** アクションを使用する前に、ブレークポイントを設定します。

    - バージョン 1910 以降では、デバッガーでブレークポイントを作成した後、タスク シーケンスによってコンピューターが再起動された場合、再起動後もデバッガーによってそのブレークポイントが保持されます。<!-- 5012509 -->

    - バージョン 1906 では、コンピューターの再起動後にはブレークポイントが保存されません ([コンピューターの再起動](../understand/task-sequence-steps.md#BKMK_RestartComputer)ステップなど)。 たとえば、イメージング タスク シーケンス用にソフトウェア センターからデバッガーを起動する場合は、Windows PE フェーズでブレークを設定しないでください。 コンピューターを Windows PE で再起動すると、デバッガーはタスク シーケンスを一時停止して、ブレークを設定できるようにします。

- **[Clear All Breaks] (すべてのブレークをクリア)** :すべてのブレークポイントを削除します。

- **ログ ファイル**:[CMTrace](../../core/support/cmtrace.md) を使用して、現在のタスク シーケンスのログ ファイル **smsts.log** を開きます。 タスク シーケンス エンジンが「デバッガーを待機している」場合、ログ エントリが表示されます。

- **[Cmd Prompt] (コマンド プロンプト)** :Windows PE では、コマンド プロンプトが開きます。

- **キャンセル**:デバッガーを閉じてタスク シーケンスを失敗させます。

- **Quit (終了)** :デバッガーをデタッチして終了しますが、タスク シーケンスは正常に実行され続けます。

**タスク シーケンス変数**ウィンドウには、タスク シーケンス環境内のすべての変数の現在の値が表示されます。 詳しくは、「[タスク シーケンス変数](../understand/task-sequence-variables.md)」をご覧ください。 [タスク シーケンス変数の設定](../understand/task-sequence-steps.md#BKMK_SetTaskSequenceVariable)ステップと **[この値を表示しない]** オプションを使用すると、変数値はデバッガーに表示されません。 デバッガーで変数の値を編集することはできません。

> [!Note]
> 一部のタスク シーケンス変数は内部でのみ使用され、リファレンス ドキュメントには記載されていません。

タスク シーケンス デバッガーは、[コンピューターの再起動](../understand/task-sequence-steps.md#BKMK_RestartComputer)ステップの後も引き続き実行されますが、ブレークポイントを再作成する必要があります。 タスク シーケンスで必要とされない場合でも、デバッガーはユーザーの操作を必要とするため、Windows にサインインして続行する必要があります。 1 時間サインインせずにデバッグを続行した場合、タスク シーケンスは失敗します。

また、[タスク シーケンスの実行](../understand/task-sequence-steps.md#child-task-sequence)ステップで子タスク シーケンスにステップインします。 [デバッガー] ウィンドウには、メイン タスク シーケンスと共に子タスク シーケンスのステップが表示されます。


## <a name="known-issues"></a>既知の問題

複数の展開によって通常の展開とデバッグの展開の両方を同じデバイスに対して実行すると、タスク シーケンス デバッガーが起動しないことがあります。


## <a name="see-also"></a>関連項目

- [タスク シーケンスのステップについて](../understand/task-sequence-steps.md)
- [タスク シーケンス変数](../understand/task-sequence-variables.md)
- [タスク シーケンス変数の使用方法](../understand/using-task-sequence-variables.md)
- [タスク シーケンスの展開](deploy-a-task-sequence.md)
