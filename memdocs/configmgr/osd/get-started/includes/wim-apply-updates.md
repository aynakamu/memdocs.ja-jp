---
author: aczechowski
ms.author: aaroncz
ms.prod: configuration-manager
ms.topic: include
ms.date: 05/28/2019
ms.openlocfilehash: e5c15556a7a8dd91db3ae2c4aa4f9830abc8e430
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/21/2020
ms.locfileid: "81708880"
---
## <a name="apply-software-updates-to-an-image"></a><a name="BKMK_OSImagesApplyUpdates"></a> ソフトウェア更新プログラムをイメージに適用

> [!Note]  
> このセクションは、**OS イメージ**と **OS アップグレード パッケージ**の両方に適用されます。 ここでは、Windows イメージ ファイル (WIM) を表すのに一般的な用語 "イメージ" を使用します。 これらの両方のオブジェクトには WIM が存在し、これには Windows インストール ファイルが含まれます。 ソフトウェア更新プログラムは、両方のオブジェクトでこれらのファイルに適用されます。 このプロセスの動作は、両方のオブジェクト間で同じです。  

毎月、イメージに適用できる新しいソフトウェア更新プログラムが発行されます。 ソフトウェア更新プログラムを適用するには、まず次の前提条件が必要となります。

- ソフトウェア更新プログラムのインフラストラクチャ  
- 正常に同期されたソフトウェア更新プログラム  
- サイト サーバー上のコンテンツ ライブラリにソフトウェア更新プログラムをダウンロード済み  

詳細については、「[ソフトウェアの更新の展開方法](../../../sum/deploy-use/deploy-software-updates.md)」を参照してください。  

適用可能なソフトウェア更新プログラムを、指定したスケジュールでイメージに適用します。 このプロセスは*オフライン サービス*と呼ばれることもあります。 このスケジュールで、Configuration Manager により、選択したソフトウェア更新プログラムがイメージに適用されます。 その後、更新されたイメージを配布ポイントに再配布することもできます。

> [!Important]  
> バージョンに基づいてイメージに適用できる任意のソフトウェア更新プログラムを選択できますが、DISM では特定の種類の更新プログラムのみがイメージに適用できます。 **OfflineServicingMgr.log** ファイルには、エントリ `Not applying this update binary, it is not supported` が表示されます。<!-- SCCMDocs issue 1324 -->

サイト データベースには、インポート時点で適用されたソフトウェア更新プログラムなど、イメージに関する情報が保管されます。 最初の追加以降、イメージに適用したソフトウェア更新プログラムもサイト データベースに保管されます。 ソフトウェア更新プログラムを適用するウィザードを起動すると、ウィザードは、サイトでイメージにまだ適用されていない適用可能なソフトウェア更新プログラムのリストを取得します。 Configuration Manager により、サイト サーバー上のコンテンツ ライブラリから選択したソフトウェア更新プログラムがコピーされます。 その後、ソフトウェア更新プログラムがイメージに適用されます。  

### <a name="servicing-process"></a>サービス プロセス

1. Configuration Manager コンソールで、 **[ソフトウェア ライブラリ]** ワークスペースに移動し、 **[オペレーティング システム]** を展開して、 **[オペレーティング システム イメージ]** または **[オペレーティング システム アップグレード パッケージ]** を選択します。  

2. ソフトウェア更新プログラムを適用するオブジェクトを選択します。  

3. リボンで **[更新のスケジュール]** を選択して、ウィザードを起動します。  

4. **[更新プログラムの選択]** ページで、イメージに適用するソフトウェア更新プログラムを選択します。 更新プログラムのリストがウィザードに表示されるまで、多少時間がかかる場合があります。 **[フィルター]** を使用して、メタデータ内の文字列を検索します。 **[システム アーキテクチャ]** ドロップダウン リストを使用して、 **[X86]** 、 **[X64]** 、または **[すべて]** でフィルター処理します。 リストで 1 つ、複数、またはすべての更新プログラムを選択できます。 更新プログラムの選択が完了したら、 **[次へ]** を選択します。  

5. **[スケジュールの設定]** ページで、次の設定を指定してから、 **[次へ]** をクリックします。  

    1. **スケジュール**: サイトでソフトウェア更新プログラムをイメージに適用するスケジュールを指定します。  

    2. **エラー時に続行する**: このオプションを選択すると、エラーが発生した場合でも、イメージにソフトウェア更新プログラムがそのまま適用されます。  

    3. **イメージを使用して配布ポイントを更新する**: このオプションを選択すると、サイトでソフトウェア更新プログラムが適用された後、配布ポイントのイメージが更新されます。  

6. [更新のスケジュール] ウィザードを完了します。  

> [!NOTE]  
> ペイロードのサイズを最小限に抑えるために、OS アップグレード パッケージと OS イメージのサービス提供では古いバージョンが削除されます。  

### <a name="servicing-operations"></a>サービス操作

Configuration Manager コンソールの **[OS イメージ]** ノードまたは **[OS アップグレード パッケージ]** ノードで、ビューに次の列を追加します。

- **スケジュールされた更新日**: このプロパティは、次回の定義済みスケジュールを表示します。  
- **スケジュールされた更新のステータス** : このプロパティは、ステータスを表示します。 たとえば、 **[成功]** や **[進行中]** などです。  

特定のイメージ オブジェクトを選択し、詳細ウィンドウの **[更新状態]** タブに切り替えます。 このタブには、イメージの更新プログラムのリストが表示されます。

特定のイメージ オブジェクトを選択し、リボンで **[プロパティ]** を選択します。 **[インストールされた更新プログラム]** タブには、イメージの更新プログラムのリストが表示されます。 **[サービス]** タブは、現在のサービスのスケジュールと、適用するようスケジュールした更新プログラムの読み取り専用ビューです。

ステータスが **[進行中]** の場合は、リボンで **[スケジュールされた更新の取り消し]** を選択できます。 このアクションは、アクティブなサービス プロセスをキャンセルします。

このプロセスをトラブルシューティングするには、サイト サーバー上の **OfflineServicingMgr.log** ファイルと **dism.log** ファイルを確認します。 詳細については、[ログ ファイル](../../../core/plan-design/hierarchy/log-files.md)に関するページを参照してください。

### <a name="specify-the-drive-for-offline-os-image-servicing"></a><a name="bkmk_servicing-drive"></a> オフライン OS イメージ サービス用のドライブを指定する

<!--1358924-->

バージョン 1810 以降では、OS イメージのオフライン サービス中に Configuration Manager が使用するドライブを指定します。 このプロセスは、一時ファイルで大量のディスク領域を使用する可能性があります。 このオプションにより、使用するドライブを柔軟に選択できます。

1. Configuration Manager コンソールで、 **[管理]** ワークスペースに移動し、 **[サイトの構成]** を展開して **[サイト]** ノードを選択します。 リボンで **[サイト コンポーネントの構成]** をクリックし、 **[オペレーティング システムの展開]** を選択します。  

2. **[オフライン サービス]** タブで、 **[イメージのオフライン サービスで使用するローカル ドライブ]** のオプションを指定します。  

この設定の既定値は **[自動]** です。 この値では、Configuration Manager がインストール対象のドライブを選択します。

サイト サーバー上に存在しないドライブを選択すると、Configuration Manager は、 **[自動]** を選択した場合と同じ動作をします。

オフライン サービス中、Configuration Manager は一時ファイルをフォルダー `<drive>:\ConfigMgr_OfflineImageServicing` に格納します。 また、このフォルダー内の OS イメージをマウントします。

### <a name="optimized-image-servicing"></a><a name="bkmk_resetbase"></a> 最適化されたイメージ サービス

<!--3555951-->

バージョン 1902 以降では、OS イメージにソフトウェア更新プログラムを適用するときに、置き換えられた更新プログラムを削除することによって、出力を最適化する新しいオプションがあります。 オフライン サービスに対する最適化は、単一インデックスのイメージにのみ適用されます。

サイトでの OS イメージに対するソフトウェア更新プログラムの適用をスケジュールするときは、Windows 展開イメージのサービスと管理 (DISM) のコマンド ライン ツールを使用します。 この変更では、サービス プロセスに次の 2 つの追加ステップが導入されています。  

- マウントされているオフライン イメージに対し、パラメーター `/Cleanup-Image /StartComponentCleanup /ResetBase` を使用して DISM が実行されます。 このコマンドが失敗した場合、現在のサービス プロセスは失敗します。 イメージにはどのような変更もコミットされません。  

- イメージは、Configuration Manager によって変更をコミットされ、ファイル システムからマウント解除された後、別のファイルにエクスポートされます。 このステップでは、DISM パラメーター `/Export-Image` が使用されます。 イメージから不要なファイルが削除されて、サイズが小さくなります。  

定期的にオフライン イメージに更新プログラムを適用することをお勧めします。 イメージのサービスを行うたびに、このオプションを使用する必要はありません。 このプロセスを毎月実行することで、時間の経過と共にこの新しいオプションによる大きなメリットがあります。 詳細については、[ソフトウェア更新プログラムのインストール手順の推奨事項](../../understand/install-software-updates.md#recommendations)に関するページを参照してください。

このオプションを使用すると、サービス対象のイメージの全体的なサイズを減らすのに役立ちますが、プロセスの完了に要する時間が長くなります。 ウィザードを使用して、都合のよい時間にサービスが行われるようスケジュールを設定してください。 また、サイト サーバー上でストレージが余分に必要になります。 サイトで代替の場所を使用するようにカスタマイズできます。 詳細については、「[オフライン OS イメージ サービス用のドライブを指定する](#bkmk_servicing-drive)」をご覧ください。

#### <a name="process-to-optimize-image-servicing"></a>イメージ サービスを最適化するプロセス

1. [サービス プロセス](#servicing-process)を開始します。  

2. **[スケジュールの設定]** ページで、 **[イメージが更新された後、置き換えられた更新プログラムを削除する]** オプションをオンにします。 このオプションは、自動的には有効になりません。 イメージに複数のインデックスがある場合は、このオプションを使用できません。  

3. イメージ サービスをスケジュールするには、ウィザードを使用します。  

**OfflineServicing.log** を使用して、プロセスを検証し、監視します。
