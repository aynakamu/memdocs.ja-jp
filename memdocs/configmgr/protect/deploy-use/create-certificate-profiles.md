---
title: SCEP 証明書プロファイルの作成
titleSuffix: Configuration Manager
description: 証明書プロファイルを使用して、必要な証明書でマネージド デバイスをプロビジョニングする方法について学習します
ms.date: 11/29/2019
ms.prod: configuration-manager
ms.technology: configmgr-protect
ms.topic: conceptual
ms.assetid: 634d612c-92d7-4c03-873a-b2e730c9a72d
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: 159afbf2c5aae9516fc5244ee06a2aa484290c20
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/21/2020
ms.locfileid: "81705770"
---
# <a name="create-certificate-profiles"></a>証明書プロファイルの作成

*適用対象:Configuration Manager (Current Branch)*

Configuration Manager で証明書プロファイルを使用して、会社のリソースにアクセスするために必要な証明書でマネージド デバイスをプロビジョニングします。 証明書プロファイルを作成する前に、[証明書インフラストラクチャの設定](certificate-infrastructure.md)に関するページで説明するように、証明書インフラストラクチャを設定します。  

> [!TIP]
> 共同管理デバイスの場合は、[**リソース アクセス ポリシー** ワークロード](../../comanage/workloads.md#resource-access-policies)を Intune に移行することを検討してください。 その後、Intune ポリシーを使用してこれらの証明書を管理します。 詳細については、[ワークロードを切り替える方法](../../comanage/how-to-switch-workloads.md)に関するページをご覧ください。

この記事では、信頼されたルートおよび Simple Certificate Enrollment Protocol (SCEP) 証明書プロファイルを作成する方法について説明します。 PFX 証明書プロファイルを作成する場合は、「[PFX 証明書プロファイルを作成する方法](../../mdm/deploy-use/create-pfx-certificate-profiles.md)」をご覧ください。

証明書プロファイルを作成するには:

1. 証明書プロファイルの作成ウィザードを開始します。
1. 証明書の全般的な情報を指定します。
1. 信頼された証明機関 (CA) 証明書を構成します。  
1. SCEP 証明書情報を構成します。  
1. 証明書プロファイルの対応プラットフォームを指定します。

## <a name="start-the-wizard"></a>ウィザードの開始  

証明書プロファイルの作成を開始するには

1. Configuration Manager コンソールの **[資産とコンプライアンス]** ワークスペースに移動して、 **[コンプライアンス設定]** 、 **[会社リソースのアクセス]** の順に展開し、 **[証明書プロファイル]** ノードを選択します。  

1. リボンの **[ホーム]** タブの **[作成]** グループで、 **[証明書プロファイルの作成]** を選択します。  

## <a name="general"></a>全般

証明書プロファイルの作成ウィザードの **[全般]** ページで、次の情報を指定します。  

- **名前**:証明書プロファイルの一意の名前を入力します。 最大 256 文字を使用できます。  

- **説明**:証明書プロファイルの概要についての簡単な説明を指定します。 また、Configuration Manager コンソールで特定するのに役立つその他の関連情報も含めます。 最大 256 文字を使用できます。  

- 作成する証明書プロファイルの種類を指定します: 

  - **信頼された CA 証明書**: ユーザーまたはデバイスによって他のデバイスが認証される必要があるときに、信頼されたルート証明機関 (CA) 証明書または中間 CA 証明書を展開して信頼証明書チェーンを形成する場合に、この種類を選択します。 たとえば、リモート認証ダイヤルイン ユーザー サービス (RADIUS) サーバーや仮想プライベート ネットワーク (VPN) サーバーなどのデバイスで認証する場合が当てはまります。
  
    また、SCEP 証明書プロファイルを作成する前に、信頼された証明機関証明書プロファイルも構成します。 この場合、信頼された証明機関証明書は、ユーザーまたはデバイスに証明書を発行する証明機関に対するものでなければなりません。  

  - **Simple Certificate Enrollment Protocol (SCEP) 設定**: Simple Certificate Enrollment Protocol とネットワーク デバイス登録サービス (NDES) の役割サービスを使用して、ユーザーまたはデバイスの証明書を要求する場合は、この種類を選択します。

  - **Personal Information Exchange PKCS #12 (PFX) の設定 - インポート**: PFX 証明書をインポートする場合に、このオプションを選択します。 詳細については、[PFX 証明書プロファイルのインポート](../../mdm/deploy-use/import-pfx-certificate-profiles.md)に関するページを参照してください。

  - **Personal Information Exchange -- PKCS #12 (PFX) 設定 -- 作成**: 証明機関を使用して PFX 証明書を処理するには、このオプションを選択します。 詳細については、[PFX 証明書プロファイルの作成](../../mdm/deploy-use/create-pfx-certificate-profiles.md)に関するページを参照してください。

## <a name="trusted-ca-certificate"></a>信頼された証明機関証明書  

> [!IMPORTANT]  
> SCEP 証明書プロファイルを作成する前に、少なくとも 1 つの信頼された証明機関証明書プロファイルを構成します。
>
> 証明書を展開した後に、次のいずれかの値を変更すると、新しい証明書が要求されます。
>
> - キー格納プロバイダー
> - 証明書テンプレート名
> - 証明書の種類
> - サブジェクト名の形式
> - サブジェクト代替名
> - 証明書の有効期間
> - キー使用法
> - キーのサイズ
> - 拡張キー使用法
> - ルート CA 証明書

1. 証明書プロファイルの作成ウィザードの **[信頼された証明機関証明書]** ページで、次の情報を指定します。  

    - **証明書ファイル**: **[インポート]** を選択してから、証明書ファイルを見つけます。  

    - **保存先ストア**: デバイスに証明書ストアが複数ある場合は、証明書の保存先を選択します。 ストアが 1 つのみのデバイスの場合、この設定は無視されます。  

2. **[証明書の拇印]** 値を使用して、正しい証明書がインポートされたことを確認します。  

## <a name="scep-certificates"></a>SCEP 証明書

### <a name="1-scep-servers"></a>1.SCEP サーバー

証明書プロファイルの作成ウィザードの **[SCEP サーバー]** ページで、SCEP 経由で証明書を発行する NDES サーバーの URL を指定します。 証明書登録ポイントの構成に基づいて NDES URL を自動的に割り当てることも、手動で URL を追加することもできます。  

### <a name="2-scep-enrollment"></a>2.SCEP 登録

証明書プロファイルの作成ウィザードの **[SCEP 登録]** ページで情報を指定します。

- **再試行**: NDES サーバーに、デバイスが証明書の要求を自動的に再試行する回数を指定します。 この設定は、CA マネージャーが証明書の要求を事前に承認する必要があるシナリオをサポートします。 この設定は、通常、厳重なセキュリティを施行している環境や、エンタープライズ CA ではなくスタンドアロン CA がある環境で使用します。 また、発行元 CA が証明書要求を処理する前に証明書要求オプションを確認するテスト目的で、この設定を使用することもあります。 この設定は、 **[再試行の待ち時間 (分)]** 設定と共に使用してください。  

- **再試行の待ち時間 (分)** : 発行元 CA が証明書要求を処理する前に CA マネージャーの承認を使用するときの、登録の再試行間隔 (分) を指定します。 テスト目的でマネージャーの承認を使用する場合は、低い値を指定します。 要求を承認した後、デバイスが証明書の要求を再試行するまでの時間が長くなることはありません。

    実稼働ネットワークでマネージャーの承認を使用する場合は、高い値を指定します。 この動作により、CA 管理者が保留中の承認を承認または拒否するために十分な時間が確保されます。  

- **[更新しきい値 (%)]** : 証明書の有効期間の残りがどの程度 (%) になったら、デバイスが更新を要求するかを指定します。  

- **キー格納プロバイダー (KSP)** : 証明書のキーを格納する場所を指定します。 次のいずれかの値を選択します。  

  - **トラステッド プラットフォーム モジュール (TPM) にインストールする (存在する場合)** : TPM にキーをインストールします。 TPM が存在しない場合、キーはソフトウェア キー用の格納プロバイダーにインストールされます。  

  - **トラステッド プラットフォーム モジュール (TPM) にインストールする (それ以外は失敗)** : TPM にキーをインストールします。 TPM モジュールが存在しない場合、インストールは失敗します。  

  - **Windows Hello for Business にインストールする (それ以外は失敗)** : このオプションは、Windows 10 デバイスで使用できます。 これにより、多要素認証で保護されている Windows Hello for Business ストアに証明書を格納できます。 詳細については、「[Windows Hello for Business](https://docs.microsoft.com/windows/security/identity-protection/hello-for-business/hello-identity-verification)」を参照してください。

    > [!NOTE]  
    > このオプションは、[証明書のプロパティ] ページでの拡張キー使用法のスマート カード ログオンをサポートしていません。

  - **ソフトウェア キー記憶域プロバイダーにインストールする**: ソフトウェア キー格納プロバイダーにキーをインストールします。  

- **証明書登録用のデバイス**: 証明書プロファイルをユーザー コレクションに展開する場合は、証明書の登録をユーザーのプライマリ デバイスだけに許可するか、ユーザーがサインインする任意のデバイスに許可します。

    証明書プロファイルをデバイス コレクションに展開する場合は、証明書の登録をデバイスのプライマリ ユーザーだけに許可するか、デバイスにサインインするすべてのユーザーに許可します。  

### <a name="3-certificate-properties"></a>3.証明書のプロパティ

証明書プロファイルの作成ウィザードの **[証明書のプロパティ]** ページで、次の情報を指定します。  

- **証明書テンプレート名**: NDES で構成し、発行元の CA に追加した証明書テンプレートの名前を選択します。 ユーザー アカウントが証明書テンプレートを参照するには、証明書テンプレートに対する**読み取り**アクセス許可が必要です。 証明書を**参照**できない場合は、その名前を入力します。  

  > [!IMPORTANT]
  > 証明書テンプレート名に ASCII 以外の文字が含まれている場合、証明書は展開されません  (これらの文字の一例が漢字です)。証明書が展開されていることを確認するには、まず CA で証明書テンプレートのコピーを作成します。 次に、ASCII 文字を使用して、コピーの名前を変更します。  

  - "*参照*" して証明書テンプレートの名前を選択した場合、ページ内の一部のフィールドは、その証明書テンプレートから自動的に埋められます。 場合によっては、別の証明書テンプレートを選択しないと、これらの値を変更できないことがあります。  

  - 証明書テンプレートの名前を*入力*した場合は、その名前が証明書テンプレートの名前と完全に一致していることを必ず確認してください。 NDES サーバーのレジストリに記載されている名前と一致している必要があります。 必ず、証明書テンプレートの表示名ではなく、証明書テンプレートの名前を指定してください。  

    証明書テンプレートの名前を調べるには、`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography\MSCEP` というレジストリ キーを参照します。 これには、"**EncryptionTemplate**"、"**GeneralPurposeTemplate**"、"**SignatureTemplate**" の値として証明書テンプレートが一覧されます。 既定では、3 つの証明書テンプレートのすべての値は **[IPSECIntermediateOffline]** です。これは、 **[IPsec (オフライン要求)]** のテンプレートの表示名にマップされます。  

    > [!WARNING]  
    > 証明書テンプレートの名前を入力しても、Configuration Manager は証明書テンプレートの内容を確認できません。 証明書テンプレートでサポートされていないオプションを選択できる場合があります。これにより、証明書の要求が失敗する可能性があります。 この動作が発生すると、CPR.log ファイルで証明書署名要求 (CSR) のテンプレート名とチャレンジが一致しないという w3wp.exe のエラー メッセージを確認できます。  
    >
    > "**GeneralPurposeTemplate**" 値に指定した証明書テンプレートの名前を入力するときに、この証明書プロファイルの **[キーの暗号化]** オプションと **[デジタル署名]** オプションを選択します。 この証明書プロファイルで **[キーの暗号化]** オプションのみを有効にする場合は、"**EncryptionTemplate**" キーの証明書テンプレート名を指定します。 同様に、この証明書プロファイルで **[デジタル署名]** オプションのみを有効にする場合は、 **[SignatureTemplate]** キーの証明書テンプレート名を指定します。  

- **[証明書の種類]** : 証明書をデバイスとユーザーのどちらに展開するかを選択します。  

- **[サブジェクト名の形式]** : Configuration Manager で証明書要求のサブジェクト名を自動作成する方法を選択します。 証明書がユーザー用の場合、サブジェクト名にユーザーのメール アドレスを追加することもできます。

    > [!NOTE]  
    > **[IMEI 番号]** または **[シリアル番号]** を選択した場合、同じユーザーが所有するさまざまなデバイスを区別できます。 たとえば、デバイスで共通名を共有できますが、IMEI 番号やシリアル番号は共有できません。 デバイスによって IMEI やシリアル番号がレポートされない場合、証明書は共通名で発行されます。

- **[サブジェクトの別名]** : 証明書要求のサブジェクトの別名 (SAN) の値を、Configuration Manager でどのように自動生成するかを指定します。 たとえば、ユーザー証明書の種類を選択した場合は、サブジェクトの別名にユーザー プリンシパル名 (UPN) を含めることができます。 ネットワーク ポリシー サーバーに対する認証をクライアント証明書を使って行う場合は、サブジェクトの別名を UPN に設定します。  

- **[証明書の有効期間]** : 発行元 CA でカスタム有効期間を設定する場合は、証明書が失効するまでの残り時間を指定します。

    > [!TIP]
    > 次のコマンド ラインを使用して、カスタム有効期間を設定します。`certutil -setreg Policy\EditFlags +EDITF_ATTRIBUTEENDDATE`
    > このコマンドの詳細については、「[証明書インフラストラクチャ](certificate-infrastructure.md)」を参照してください。  

    指定した証明書テンプレートの有効期限よりも小さい値を指定できますが、大きい値は指定できません。 たとえば、証明書テンプレートで証明書の有効期限が 2 年になっている場合は、この値を 1 年することはできますが、5 年にすることはできません。 また、発行元の CA の証明書の残りの有効期限よりも小さい値を指定する必要があります。  

- **キー使用法**: 証明書のキー使用法のオプションを指定します。 次のオプションを選択します。  

  - **[キーの暗号化]** : キーが暗号化されている場合のみ、キーを交換できます。  

  - **デジタル署名**: キーがデジタル署名で保護されている場合のみ、キーを交換できます。  

  証明書テンプレートを参照した場合は、別の証明書テンプレートを選択しないと、これらの設定を変更できません。  

  選択した証明書テンプレートには、上記のキー使用法オプションの 1 つまたは両方を構成します。 それ以外の場合は、証明書登録ポイントのログ ファイル (**Crp.log**) で次のメッセージが表示されます。**CSR とチャレンジでのキー使用法が一致しません**  

- **[キー サイズ (ビット)]** : キーのサイズをビット単位で選択します。  

- **[拡張キー使用法]** : 証明書の使用目的に対応する値を追加します。 ほとんどの場合、サーバーに対してユーザーまたはデバイスを認証できるように、証明書には "**クライアント認証**" が必要です。 必要に応じてその他のキー使用法を追加することができます。  

- **ハッシュ アルゴリズム**: この証明書で使用するハッシュ アルゴリズムの種類を 1 つ選択します。 接続しているデバイスをサポートするセキュリティの最も強力なレベルを選択します。  

  > [!NOTE]  
  > **SHA-2** では、SHA-256、SHA-384、および SHA-512 をサポートします。 **SHA-3** では、SHA-3 のみをサポートします。  

- **ルート CA 証明書**: 既に構成して、ユーザーまたはデバイスに展開しているルート証明機関証明書プロファイルを選択します。 この CA 証明書は、この証明書プロファイルで構成している証明書を発行する CA のルート証明書である必要があります。  

  > [!IMPORTANT]  
  > ユーザーまたはデバイスに展開されていないルート証明機関証明書を指定すると、Configuration Manager によって、この証明書プロファイルで構成している証明書要求が開始されません。  

## <a name="supported-platforms"></a>サポートされているプラットフォーム  

[証明書プロファイルの作成] ウィザードの **[サポートされているプラットフォーム]** ページで、証明書プロファイルをインストールする OS のバージョンを選択します。 すべての使用可能なオペレーティング システムに証明書プロファイルをインストールするには、 **[すべて選択]** を選択します。

## <a name="next-steps"></a>次のステップ

新しい証明書プロファイルが、 **[資産とコンプライアンス]** ワークスペースの **[証明書プロファイル]** ノードに表示されます。 ユーザーまたはデバイスに展開する準備ができています。 詳細については、[プロファイルの展開方法](deploy-wifi-vpn-email-cert-profiles.md)に関するページを参照してください。
