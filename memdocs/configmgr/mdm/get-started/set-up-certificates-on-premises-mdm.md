---
title: オンプレミス MDM の証明書
titleSuffix: Configuration Manager
description: Configuration Manager で、オンプレミスのモバイルデバイス管理 (MDM) との信頼された通信用の証明書を設定します。
ms.date: 01/09/2020
ms.prod: configuration-manager
ms.technology: configmgr-mdm
ms.topic: conceptual
ms.assetid: 2a7d7170-1933-40e9-96d6-74a6eb7278e2
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: bc63a21970bb522407c86d027690b83894b3cb99
ms.sourcegitcommit: 578ad1e8088f7065b565e8a4f4619f5a26b94001
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/21/2020
ms.locfileid: "81724666"
---
# <a name="set-up-certificates-for-trusted-communications-with-on-premises-mdm"></a>オンプレミス MDM との信頼された通信用の証明書を設定する

*適用対象:Configuration Manager (Current Branch)*

オンプレミスモバイルデバイス管理 (MDM) を Configuration Manager には、管理対象デバイスとの信頼された通信用にサイトシステムの役割を構成する必要があります。 次の2種類の証明書が必要です。

- 必要なサイトシステムの役割をホストしているサーバー上の IIS の**web サーバー証明書**。 1台のサーバーが複数のサイトシステムの役割をホストしている場合は、そのサーバーの証明書を1つだけ必要とします。 各ロールが個別のサーバー上にある場合は、各サーバーに個別の証明書が必要です。

- Web サーバー証明書を発行する証明機関 (CA) の**信頼されたルート証明書**。 サイトシステムの役割に接続する必要があるすべてのデバイスに、このルート証明書をインストールします。

ドメインに参加しているデバイスの場合、Active Directory 証明書サービスを使用すると、これらの証明書はすべてのデバイスに自動的にインストールされます。 ドメインに参加していないデバイスの場合は、他の方法で信頼されたルート証明書をインストールします。

一括登録されたデバイスの場合は、登録パッケージに証明書を含めることができます。 ユーザーが登録したデバイスの場合は、電子メール、Web からのダウンロード、またはその他の方法で、証明書を追加する必要があります。

Verisign や GoDaddy などのよく知られているパブリック CA を使用してサーバー証明書を発行する場合、信頼されたルート証明書を各デバイスに手動でインストールする必要がなくなります。 ほとんどのデバイスは、これらのパブリック機関をネイティブに信頼します。 この方法は、他の方法で証明書をインストールするのではなく、ユーザーが登録したデバイスに適しています。

> [!IMPORTANT]  
> オンプレミス MDM のデバイスとサイトシステムサーバーの間で信頼された通信用の証明書を設定するには、さまざまな方法があります。 この記事の情報は、その方法の一例です。 この方法では、証明機関と証明機関の web 登録の役割を持つ Active Directory 証明書サービスが必要です。 詳細については、次を参照してください。 [Active Directory Certificate Services](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831740\(v=ws.11\))します。

## <a name="publish-the-crl"></a><a name="bkmk_configCa"></a>CRL を公開する

既定では、Active Directory 証明機関 (CA) は、LDAP ベースの証明書失効リスト (Crl) を使用します。 ドメインに参加しているデバイスの CRL への接続が許可されます。 ドメインに参加していないデバイスが CA から発行された証明書を信頼できるようにするには、HTTP ベースの CRL を追加します。

1. サイトの証明機関を実行しているサーバーで、[**スタート**] メニューを開き、[**管理ツール**] を選択して、[**証明機関**] を選択します。

1. [証明機関] コンソールで、[ **Certificateauthority**] を右クリックし、[**プロパティ**] を選択します。

1. CertificateAuthority のプロパティで、[**拡張機能**] タブに切り替えます。 **[拡張機能**が**CRL 配布ポイント (CDP)**] に設定されていることを確認します。

1. [`http://<ServerDNSName>/CertEnroll/<CAName><CRLNameSuffix><DeltaCRLAllowed>.crl`] を選択します。 次に、次のオプションを選択します。

    - **Crl に含めます。クライアントはこれを使用して Delta CRL の場所を検索します。**

    - **発行された証明書の CDP 拡張機能に含める**

    - **発行された Crl の IDP 拡張機能に含める**

1. [**終了モジュール**] タブに切り替えます。 [**プロパティ**] を選択し、[**ファイルシステムへの証明書の公開を許可する**] を選択します。 Active Directory 証明書サービスの再起動に関する通知が表示されます。

1. [失効した**証明書**] を右クリックし、[**すべてのタスク**] をクリックして、[**発行**] を選択します。

1. [CRL の公開] ウィンドウで、[ **DELTA crl のみ**] を選択し、[ **OK** ] を選択してウィンドウを閉じます。

## <a name="create-the-certificate-template"></a><a name="bkmk_certTempl"></a>証明書テンプレートを作成する

CA は、web サーバー証明書テンプレートを使用して、サイトシステムの役割をホストするサーバーの証明書を発行します。 これらのサーバーは、サイトシステムの役割と登録されたデバイスの間の信頼された通信のための SSL エンドポイントになります。

1. **CONFIGMGR MDM servers**という名前のドメインセキュリティグループを作成します。 サイトシステムサーバーのコンピューターアカウントをグループに追加します。

1. [証明機関] コンソールで、[**証明書テンプレート**] を右クリックし、[**管理**] を選択します。 この操作により、証明書テンプレートコンソールが読み込まれます。

1. 結果ウィンドウで、[**テンプレート表示名**] 列に [ **Web サーバー** ] と表示されているエントリを右クリックし、[**テンプレートの複製**] を選択します。

1. [**テンプレートの複製**] ウィンドウで、[ **windows 2003 Server、enterprise Edition**または**windows 2008 server enterprise edition**] を選択し、[ **OK]** を選択します。

    > [!TIP]
    > Configuration Manager は、V3 または Cryptography: Next Generation (CNG) 証明書とも呼ばれる Windows 2008 サーバー証明書テンプレートをサポートしています。 詳細については、「[CNG certificates overview](../../core/plan-design/network/cng-certificates-overview.md)」(CNG 証明書の概要) を参照してください。

    CA が Windows Server 2012 以降で実行されている場合、このウィンドウには [証明書テンプレートのバージョン] のオプションは表示されません。 テンプレートを複製した後、テンプレートのプロパティの [**互換性**] タブでバージョンを選択します。

1. [**新しいテンプレートのプロパティ**] ウィンドウの [**全般**] タブで、テンプレート名を入力します。 CA は、この名前を使用して、Configuration Manager サイトシステムで使用される web 証明書を生成します。 たとえば、「 **CONFIGMGR MDM web サーバー**」と入力します。

1. [**サブジェクト名**] タブに切り替え、[ **Active Directory の情報から構築**する] を選択します。 [サブジェクト名の形式] で、[ **DNS 名**] を指定します。 [**ユーザープリンシパル名 (UPN)** ] が選択されている場合は、[代替サブジェクト名] のオプションを無効にします。

1. [**セキュリティ**] タブに切り替えます。

    1. **Domain admins**および**Enterprise admins**セキュリティグループから、**登録**アクセス許可を削除します。

    1. [**追加**] を選択し、セキュリティグループの名前を入力します。 たとえば、 **CONFIGMGR MDM サーバー**などです。 [ **OK** ] を選択して、ウィンドウを閉じます。

    1. このグループに対して [**登録**] アクセス許可を選択します。 **読み取り**アクセス許可は削除しないでください。

1. [ **OK]** を選択して変更を保存し、[証明書テンプレート] コンソールを閉じます。

1. [証明機関] コンソールで、[**証明書テンプレート**] を右クリックし、[**新規作成**] をクリックして、[**発行する証明書テンプレート**] を選択します。

1. [**証明書テンプレート**の選択] ウィンドウで、新しいテンプレートを選択します。 たとえば、「 **CONFIGMGR MDM web server**」のようにします。 次に、[ **OK** ] を選択して保存し、ウィンドウを閉じます。

## <a name="request-the-certificate"></a><a name="bkmk_requestCert"></a>証明書を要求する

このプロセスでは、IIS の web サーバー証明書を要求する方法について説明します。 このプロセスは、オンプレミス MDM の役割の1つをホストする各サイトシステムサーバーに対して実行します。

1. 役割のいずれかをホストするサイトシステムサーバーで、管理者としてコマンドプロンプトを開きます。 を`mmc`入力して、空の Microsoft 管理コンソールを開きます。

1. コンソールウィンドウで、[**ファイル**] メニューの [スナップインの**追加と削除**] を選択します。

    1. 利用可能なスナップインの一覧から [**証明書**] を選択し、[**追加**] を選択します。

    1. [証明書スナップイン] ウィンドウで、[**コンピューターアカウント**] を選択します。 [**次へ**] を選択し、[**完了**] を選択してローカルコンピューターを管理します。

    1. [ **OK]** を選択して、[スナップインの追加と削除] ウィンドウを終了します。

1. [**証明書 (ローカルコンピューター)**] を展開し、[**個人**] ストアを選択します。 [**操作**] メニューの [**すべてのタスク**] を選択し、[**新しい証明書の要求**] を選択します。 この操作は Active Directory 証明書サービスと通信して、以前に作成したテンプレートを使用して新しい証明書を作成します。

    1. 証明書の登録ウィザードの [開始する前に] ページで、[**次へ**] を選択します。

    1. [証明書の登録ポリシーの選択] ページで、[ **Active Directory の登録ポリシー**] を選択し、[**次へ**] を選択します。

    1. Web サーバー証明書テンプレート (**CONFIGMGR MDM Web サーバー**) を選択し、[**登録**] を選択します。

    1. 証明書を要求したら、[**完了**] を選択します。

各サーバーには、一意の web サーバー証明書が必要です。 必要なサイトシステムの役割の1つをホストするすべてのサーバーに対して、この手順を繰り返します。 1 つのサーバーがすべてのサイト システムの役割をホストしている場合は、1 つの Web サーバー証明書のみを要求する必要があります。

## <a name="bind-the-certificate"></a><a name="bkmk_bindCert"></a>証明書をバインドする

次の手順では、web サーバーに新しい証明書をバインドします。 *登録ポイント*と*登録プロキシポイント*のサイトシステムの役割をホストする各サーバーについて、この手順を実行します。 1台のサーバーがすべてのサイトシステムの役割をホストしている場合は、このプロセスを1回だけ実行する必要があります。

> [!NOTE]
> 配布ポイントおよびデバイス管理ポイントのサイトシステムの役割に対して、このプロセスを実行する必要はありません。 これらのユーザーは、登録時に必要な証明書を自動的に受信します。

1. 登録ポイントまたは登録プロキシポイントをホストしているサーバーで、[**スタート**] メニューの [**管理ツール**] を選択し、[ **IIS マネージャー**] を選択します。

1. 接続の一覧で、[既定の**Web サイト**] を選択し、[**バインドの編集**] を選択します。

    1. [サイトバインド] ウィンドウで、[ **https**] を選択し、[**編集**] を選択します。

    1. [サイトバインドの編集] ウィンドウで、 **SSL 証明書**用に新しく登録した証明書を選択します。 [ **OK]** を選択して保存し、[**閉じる**] を選択します。

1. IIS マネージャーコンソールの [接続] の一覧で、web サーバーを選択します。 右側の [操作] パネルで、[**再起動**] を選択します。 この操作により、web サーバーサービスが再起動されます。

## <a name="export-the-trusted-root-certificate"></a><a name="bkmk_exportCert"></a>信頼されたルート証明書をエクスポートする

Active Directory 証明書サービスは、ドメインに参加しているすべてのデバイスに、CA から必要な証明書を自動的にインストールします。 ドメインに参加していないデバイスがサイトシステムの役割と通信するために必要な証明書を取得するには、web サーバーにバインドされている証明書から証明書をエクスポートします。

1. IIS マネージャーで、[**既定の Web サイト**] を選択します。 右側の [操作] パネルで、[**バインド**] を選択します。

1. [サイトバインド] ウィンドウで、[ **https**] を選択し、[**編集**] を選択します。

1. [Web サーバー証明書] を選択し、[**表示**] を選択します。

1. Web サーバー証明書のプロパティで、[証明の**パス**] タブに切り替えます。証明のパスのルートを選択し、[**証明書の表示**] を選択します。

1. ルート証明書のプロパティで、[**詳細**] タブに切り替えて、[**ファイルにコピー**] を選択します。

1. 証明書のエクスポートウィザードの [ようこそ] ページで、[**次へ**] を選択します。

1. **DER encoded binary x.509 (を選択します。CER)** を形式として指定し、[**次へ**] を選択します。

1. この信頼されたルート証明書を識別するためのパスとファイル名を入力してください。 ファイル名については、[**参照...**] をクリックし、証明書ファイルを保存する場所を選択し、ファイルに名前を付けて、[**次へ**] を選択します。

1. 設定を確認し、[**完了**] を選択して証明書をファイルにエクスポートします。

証明機関の設計によっては、追加の下位 CA ルート証明書のエクスポートが必要になる場合があります。 Web サーバー証明書の証明パスにある他の証明書をエクスポートするには、この手順を繰り返します。

## <a name="next-step"></a>次のステップ

> [!div class="nextstepaction"]
> [デバイス登録のセットアップ](set-up-device-enrollment-on-premises-mdm.md)
